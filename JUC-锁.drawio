<mxfile host="app.diagrams.net" modified="2021-07-01T08:22:06.275Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36" etag="uLuRgo_aPFDW8GMUpYdN" version="14.8.2" type="github" pages="5">
  <diagram name="加锁" id="5d7acffa-a066-3a61-03fe-96351882024d">
    <mxGraphModel dx="514" dy="1325" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="1000" pageHeight="2000" background="#ffffff" math="0" shadow="1">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="CqtvCm25UIUQusRmt474-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;" edge="1" parent="1" source="CqtvCm25UIUQusRmt474-13" target="CqtvCm25UIUQusRmt474-22">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-6" value="&lt;pre style=&quot;text-align: left ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;tryAcquire()&lt;/span&gt;&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=30;fontColor=#000000;" vertex="1" connectable="0" parent="CqtvCm25UIUQusRmt474-23">
          <mxGeometry x="0.5831" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-27" value="&lt;pre style=&quot;text-align: left ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;tryAcquire()&lt;/span&gt;&lt;/pre&gt;" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;" edge="1" parent="1" source="CqtvCm25UIUQusRmt474-13" target="CqtvCm25UIUQusRmt474-26">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.446;entryY=0.002;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=30;fontColor=#000000;" edge="1" parent="1" source="CqtvCm25UIUQusRmt474-13" target="CqtvCm25UIUQusRmt474-30">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-8" value="&lt;pre style=&quot;text-align: left ; background-color: rgb(248 , 249 , 250) ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;b&gt;acquireQueued()&lt;/b&gt;&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=30;fontColor=#000000;" vertex="1" connectable="0" parent="krwOEIBx-vB3lfnVqGeh-7">
          <mxGeometry x="0.177" y="1" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-13" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;public final void &lt;/span&gt;acquire(&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;arg) {//模板方法，tryAcquire()由子类负责实现&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(!tryAcquire(arg) &amp;amp;&amp;amp;&lt;br&gt;        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))&lt;br&gt;        selfInterrupt();&lt;br&gt;}&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontColor=#000000;align=left;" vertex="1" parent="1">
          <mxGeometry x="3070" y="740" width="778" height="133" as="geometry" />
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;" edge="1" parent="1" source="CqtvCm25UIUQusRmt474-14" target="CqtvCm25UIUQusRmt474-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3036" y="631" />
              <mxPoint x="3410" y="631" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-14" value="&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt; font-weight: bold;&quot;&gt;final void &lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt; font-weight: bold; font-style: italic;&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;() {&lt;/span&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;acquire&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;align=left;arcSize=9;labelBorderColor=none;" vertex="1" parent="1">
          <mxGeometry x="2930" y="400" width="232" height="107" as="geometry" />
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;" edge="1" parent="1" source="CqtvCm25UIUQusRmt474-19" target="CqtvCm25UIUQusRmt474-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3707" y="633" />
              <mxPoint x="3410" y="633" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-19" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final void &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;lock&lt;/span&gt;&lt;span&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;compareAndSetState&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;))//立即抢锁&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;setExclusiveOwnerThread&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;currentThread&lt;/span&gt;&lt;span&gt;())&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;else&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;        &lt;/span&gt;&lt;span&gt;acquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;//抢锁失败，&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;align=left;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="3470" y="400" width="580" height="180" as="geometry" />
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-22" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;tryAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;currentThread&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;getState&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;== &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;!&lt;/span&gt;&lt;span&gt;hasQueuedPredecessors&lt;/span&gt;&lt;span&gt;() &lt;/span&gt;&lt;span&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span&gt;compareAndSetState&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span&gt;)) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span&gt;setExclusiveOwnerThread&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    }&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current &lt;/span&gt;&lt;span&gt;== &lt;/span&gt;&lt;span&gt;getExclusiveOwnerThread&lt;/span&gt;&lt;span&gt;()) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;+ &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc &lt;/span&gt;&lt;span&gt;&amp;lt; &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;)&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;throw new &lt;/span&gt;&lt;span&gt;Error&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;&quot;Maximum lock count exceeded&quot;&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;setState&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return false&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;align=left;arcSize=7;" vertex="1" parent="1">
          <mxGeometry x="2443" y="1025" width="777" height="425" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=30;fontColor=#000000;" edge="1" parent="1" source="CqtvCm25UIUQusRmt474-26" target="krwOEIBx-vB3lfnVqGeh-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-26" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;tryAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span&gt;nonfairTryAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;br&gt;&lt;/pre&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;strokeColor=#000000;align=left;arcSize=3;" vertex="1" parent="1">
          <mxGeometry x="3744" y="1023" width="523" height="138" as="geometry" />
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-29" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;公平锁与非公平锁tryAcquire()的&lt;/span&gt;实现唯一的区别是，公平锁多了了一个!hasQueuedPredecessors()判断,&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;表示是不是排在等待队列的头部&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;glass=0;labelBackgroundColor=#ffffff;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="2433" y="1466" width="946" height="113" as="geometry" />
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-30" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;b&gt;这个方法只有抢到锁之后才会返回,&lt;/b&gt;&lt;/pre&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;&lt;b&gt;该函数不会中断响应，但它会记录被阻塞期间有没有其他线程向它发送过中断信号。如果有，则该函数会返回true；否则，返回false。&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquireQueued&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;try &lt;/span&gt;&lt;span&gt;{&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interrupted &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;false&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;for &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;;;&lt;/span&gt;&lt;span&gt;) {//在没有阻塞的情况下，不断取获取锁&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;predecessor&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p &lt;/span&gt;&lt;span&gt;== &lt;/span&gt;head &lt;span&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span&gt;tryAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;&lt;span&gt;)) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;                &lt;/span&gt;&lt;span&gt;setHead&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;next &lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;&lt;span&gt;; &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;// help GC&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;false&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interrupted&lt;/span&gt;&lt;span&gt;;//获取锁之后，返回&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;shouldParkAfterFailedAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span&gt;) &lt;/span&gt;&lt;span&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span&gt;parkAndCheckInterrupt&lt;/span&gt;&lt;span&gt;()){&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;&lt;span&gt;	&lt;/span&gt;&lt;span&gt;	&lt;/span&gt;//&lt;/span&gt;shouldParkAfterFailedAcquire&lt;span style=&quot;font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; font-weight: bold&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;)判断是否需要阻塞&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interrupted &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;true&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;&lt;span&gt;	&lt;/span&gt;    }&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    } &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;finally &lt;/span&gt;&lt;span&gt;{&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed&lt;/span&gt;&lt;span&gt;)&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span&gt;cancelAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-size: 12px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;阻塞当前线程,直到被其他线程唤醒或者被中断，该函数才返回；park（）函数返回有两种情况。&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;情况1：其他线程调用了unpark（Thread t）。&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;情况2：其他线程调用了t.interrupt（）。这里要注意的是，lock（）不能响应中断，但LockSupport.park（）会响应中断。&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;也正因为LockSupport.park（）可能被中断唤醒，acquireQueued（..）函数才写了一个for死循环；&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;唤醒之后，如果发现自己排在队列头部，就去拿锁；如果拿不到锁，则再次自己阻塞自己；&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;不断重复此过程，直到拿到锁。被唤醒之后，通过Thread.interrupted（）来判断是否被中断唤醒；&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;如果是情况1，会返回false；&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;如果是情况2，则返回true；&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;parkAndCheckInterrupt&lt;/span&gt;&lt;span&gt;() {&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-size: 12px&quot;&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;LockSupport&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;park&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;interrupted&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=none;strokeColor=#000000;fillColor=#ffffff;align=left;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="2967" y="1821" width="1104" height="1043" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=30;fontColor=#000000;" edge="1" parent="1" source="_KA6L-gr-Qn6RJLEGgCv-1" target="CqtvCm25UIUQusRmt474-14">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_KA6L-gr-Qn6RJLEGgCv-1" value="公平锁" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;glass=0;labelBackgroundColor=none;fontColor=#000000;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="2971" y="314" width="150" height="20" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=30;fontColor=#000000;" edge="1" parent="1" source="_KA6L-gr-Qn6RJLEGgCv-2" target="CqtvCm25UIUQusRmt474-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_KA6L-gr-Qn6RJLEGgCv-2" value="&lt;span style=&quot;text-align: left; font-size: 30px;&quot;&gt;非公平锁&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;glass=0;labelBackgroundColor=none;fontColor=#000000;fontSize=30;" vertex="1" parent="1">
          <mxGeometry x="3685" y="317" width="150" height="17" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-1" value="tryLock（）实现分析" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;glass=0;labelBackgroundColor=none;fontSize=30;fontColor=#000000;" vertex="1" parent="1">
          <mxGeometry x="4045" y="1185" width="350" height="50" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-4" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold ; font-style: italic&quot;&gt;nonfairTryAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal&quot;&gt;) {&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;currentThread&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;getState&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;== &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;compareAndSetState&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span&gt;)) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span&gt;setExclusiveOwnerThread&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    }&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current &lt;/span&gt;&lt;span&gt;== &lt;/span&gt;&lt;span&gt;getExclusiveOwnerThread&lt;/span&gt;&lt;span&gt;()) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;+ &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc &lt;/span&gt;&lt;span&gt;&amp;lt; &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;) &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;// overflow&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;throw new &lt;/span&gt;&lt;span&gt;Error&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;&quot;Maximum lock count exceeded&quot;&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;setState&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return false&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;strokeColor=#000000;align=left;arcSize=3;" vertex="1" parent="1">
          <mxGeometry x="3688" y="1251" width="635" height="453" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="szI1ShmyNPP52Lu-LX1a" name="解锁">
    <mxGraphModel dx="2514" dy="1325" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="kUkIeRc0tFKLB3FnhXx1-0" />
        <mxCell id="kUkIeRc0tFKLB3FnhXx1-1" parent="kUkIeRc0tFKLB3FnhXx1-0" />
        <mxCell id="hQ5Be9MLbmskBuh1OfqU-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=22;fontColor=#000000;" edge="1" parent="kUkIeRc0tFKLB3FnhXx1-1" source="hQ5Be9MLbmskBuh1OfqU-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="565" y="580" as="targetPoint" />
            <Array as="points">
              <mxPoint x="565" y="520" />
              <mxPoint x="565" y="520" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="hQ5Be9MLbmskBuh1OfqU-1" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;public final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;release&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;) {//模板方法&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(tryRelease(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;)) {释放锁；&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;= head;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold&quot;&gt;null &lt;/span&gt;&amp;amp;&amp;amp; &lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;.waitStatus != 0)&lt;br&gt;            unparkSuccessor(&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;);//唤醒队列中的其他线程;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;;&lt;br&gt;    }&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;return false&lt;/span&gt;;&lt;br&gt;}&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=30;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;align=left;" vertex="1" parent="kUkIeRc0tFKLB3FnhXx1-1">
          <mxGeometry x="290" y="260" width="540" height="240" as="geometry" />
        </mxCell>
        <mxCell id="hQ5Be9MLbmskBuh1OfqU-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.472;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=22;fontColor=#000000;exitX=0.449;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" edge="1" parent="kUkIeRc0tFKLB3FnhXx1-1" source="hQ5Be9MLbmskBuh1OfqU-2" target="hQ5Be9MLbmskBuh1OfqU-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="hQ5Be9MLbmskBuh1OfqU-2" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;tryRelease&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;releases&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;getState&lt;/span&gt;&lt;span&gt;() &lt;/span&gt;&lt;span&gt;- &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;releases&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;currentThread&lt;/span&gt;&lt;span&gt;() &lt;/span&gt;&lt;span&gt;!= &lt;/span&gt;&lt;span&gt;getExclusiveOwnerThread&lt;/span&gt;&lt;span&gt;())&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;throw new &lt;/span&gt;&lt;span&gt;IllegalMonitorStateException&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;//不是持有锁的线程释放&lt;/span&gt;直接报错&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;free &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;false&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;== &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {//每调用一次，state减1，直到为0，才表示锁释放成功&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;free &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;setExclusiveOwnerThread&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 16px&quot;&gt;&lt;font face=&quot;pt mono&quot; style=&quot;font-size: 16px&quot;&gt;因为是排他锁，只有已经持有锁的线程才有资格调用release（..），这意味着没有其他线程与它争抢。&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;所以，在上面的tryRelease（..）函数中，对state值的修改，不需要CAS操作，直接减1即可；&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot; color=&quot;#4c0099&quot;&gt;注意，加锁和解锁必须成对出现&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;    &lt;/span&gt;&lt;b&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;setState&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;)&lt;/span&gt;&lt;/b&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;b&gt;;&lt;/b&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-weight: bold&quot;&gt;free&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;}&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=30;strokeColor=#000000;fillColor=#ffffff;align=left;labelBorderColor=none;arcSize=9;" vertex="1" parent="kUkIeRc0tFKLB3FnhXx1-1">
          <mxGeometry x="210" y="580" width="800" height="490" as="geometry" />
        </mxCell>
        <mxCell id="hQ5Be9MLbmskBuh1OfqU-5" value="解锁不区分公平与非公平" style="text;html=1;align=center;verticalAlign=middle;resizable=0;points=[];autosize=1;strokeColor=none;fontSize=22;fontColor=#000000;" vertex="1" parent="kUkIeRc0tFKLB3FnhXx1-1">
          <mxGeometry x="430" y="190" width="260" height="30" as="geometry" />
        </mxCell>
        <mxCell id="hQ5Be9MLbmskBuh1OfqU-10" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;唤醒队列中的其他线程&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;unparkSuccessor&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;font-style: italic&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * If status is negative (i.e., possibly needing signal) try&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * to clear in anticipation of signalling.  It is OK if this&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * fails or if status is changed by waiting thread.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;= &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;.waitStatus;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;&amp;lt; 0)&lt;br&gt;        compareAndSetWaitStatus(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;ws&lt;/span&gt;, 0);&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;font-style: italic&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * Thread to unpark is held in successor, which is normally&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * just the next node.  But if cancelled or apparently null,&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * traverse backwards from tail to find the actual&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * non-cancelled successor.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;= &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;.next;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;== &lt;span style=&quot;font-weight: bold&quot;&gt;null &lt;/span&gt;|| &lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;.waitStatus &amp;gt; 0) {&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;for &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;= tail; &lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold&quot;&gt;null &lt;/span&gt;&amp;amp;&amp;amp; &lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;; &lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;.prev)&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;.waitStatus &amp;lt;= 0)&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;;&lt;br&gt;    }&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;)&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;LockSupport&lt;/span&gt;.unpark(&lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;.thread);&lt;font color=&quot;#ff0080&quot;&gt;//唤醒下一个在等待队列里阻塞的线程&lt;br&gt;}&lt;/font&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=22;strokeColor=#000000;fillColor=#ffffff;align=left;arcSize=9;" vertex="1" parent="kUkIeRc0tFKLB3FnhXx1-1">
          <mxGeometry x="230" y="1140" width="720" height="680" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="JNv3_J8_Sh6OVfC3o5AA" name="中断锁">
    <mxGraphModel dx="1554" dy="969" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="GkP1prsd0XOYrcYADEeq-0" />
        <mxCell id="GkP1prsd0XOYrcYADEeq-1" parent="GkP1prsd0XOYrcYADEeq-0" />
        <mxCell id="SpEC_mB6sUZVsmlTsD8X-0" value="lockInterruptibly（）实现分析" style="text;whiteSpace=wrap;html=1;fontSize=22;fontColor=#000000;" vertex="1" parent="GkP1prsd0XOYrcYADEeq-1">
          <mxGeometry x="690" y="110" width="310" height="40" as="geometry" />
        </mxCell>
        <mxCell id="SpEC_mB6sUZVsmlTsD8X-2" value="&lt;font style=&quot;font-size: 16px&quot;&gt;lock（）不能被中断，lockInterruptibly（）可以被中断；lock（）必须等被中断的线程获取锁之后才能响应中断&lt;br&gt;&lt;/font&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;lockInterruptibly&lt;/span&gt;&lt;span&gt;() &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;InterruptedException &lt;/span&gt;&lt;span&gt;{&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;sync&lt;span&gt;.&lt;/span&gt;&lt;span&gt;acquireInterruptibly&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;br&gt;&lt;/pre&gt;&lt;br&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=22;strokeColor=#000000;fillColor=#ffffff;align=left;" vertex="1" parent="GkP1prsd0XOYrcYADEeq-1">
          <mxGeometry x="500" y="160" width="730" height="240" as="geometry" />
        </mxCell>
        <mxCell id="B13aK4WdRRfeDaFlvRMU-0" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;public final void &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquireInterruptibly&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;) &lt;span style=&quot;font-weight: bold&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;InterruptedException &lt;/span&gt;{&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;.interrupted())&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;throw new &lt;/span&gt;InterruptedException();//如果当前线程被中断了，直接抛中断异常&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(!tryAcquire(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;))//这里的tryAcquire()和lock()里的实现一样，分为公平实现和非公平实现&lt;br&gt;        doAcquireInterruptibly(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;);&lt;br&gt;}&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=22;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;align=left;" vertex="1" parent="GkP1prsd0XOYrcYADEeq-1">
          <mxGeometry x="470" y="480" width="860" height="200" as="geometry" />
        </mxCell>
        <mxCell id="B13aK4WdRRfeDaFlvRMU-1" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-size: 12.8pt ; font-weight: bold&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; font-weight: bold ; font-style: italic&quot;&gt;doAcquireInterruptibly&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; font-weight: bold&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; font-weight: bold&quot;&gt;InterruptedException &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;{&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;addWaiter&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;EXCLUSIVE)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;try &lt;/span&gt;&lt;span&gt;{&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;for &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;;;&lt;/span&gt;&lt;span&gt;) {//&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;predecessor&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p &lt;/span&gt;&lt;span&gt;== &lt;/span&gt;head &lt;span&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span&gt;tryAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;&lt;span&gt;)) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;                &lt;/span&gt;&lt;span&gt;setHead&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;next &lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;&lt;span&gt;; &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;// help GC&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;false&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;shouldParkAfterFailedAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span&gt;) &lt;/span&gt;&lt;span&gt;&amp;amp;&amp;amp;&lt;br&gt;&lt;/span&gt;&lt;span&gt;                &lt;/span&gt;&lt;span&gt;parkAndCheckInterrupt&lt;/span&gt;&lt;span&gt;())&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;b&gt;               &lt;font color=&quot;#ea6b66&quot;&gt; //和acquireQueued()实现一样，唯一的区别是返回布尔值还是抛异常&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;span&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;throw new &lt;/span&gt;&lt;span&gt;InterruptedException&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    } &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;finally &lt;/span&gt;&lt;span&gt;{&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed&lt;/span&gt;&lt;span&gt;)&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span&gt;cancelAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=none;fontSize=22;strokeColor=#000000;fillColor=#ffffff;align=left;" vertex="1" parent="GkP1prsd0XOYrcYADEeq-1">
          <mxGeometry x="460" y="740" width="860" height="720" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="m-LhpGy6pDTVkrjs-Amt" name="读写锁">
    <mxGraphModel dx="2514" dy="1325" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2000" pageHeight="4000" math="0" shadow="0">
      <root>
        <mxCell id="4Kn29drxNQvWNtrvnITc-0" />
        <mxCell id="4Kn29drxNQvWNtrvnITc-1" parent="4Kn29drxNQvWNtrvnITc-0" />
        <mxCell id="4Kn29drxNQvWNtrvnITc-2" value="读写锁" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;glass=0;labelBackgroundColor=none;fontSize=30;fontColor=#000000;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="880" y="590" width="190" height="40" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-0" value="ReadWriteLock" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=16;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="820" y="440" width="210" height="100" as="geometry">
            <mxRectangle x="920" y="820" width="150" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-1" value="Lock readLock()" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;" vertex="1" parent="mh4P0uBNXgxFaoqxqVZ_-0">
          <mxGeometry y="26" width="210" height="26" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-2" value="Lock writeLock()" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;" vertex="1" parent="mh4P0uBNXgxFaoqxqVZ_-0">
          <mxGeometry y="52" width="210" height="26" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-4" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ReentrantReadWriteLock&lt;/span&gt;&lt;/pre&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+ readerLock: ReadLock implement Lock&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+ writerLock: ReadLock implement Lock&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;+ readLock(): ReadLock&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;+ writeLock(): WriteLock&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;rounded=0;glass=0;labelBackgroundColor=#ffffff;strokeColor=#000000;fillColor=#ffffff;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="1270" y="390" width="340" height="240" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=16;fontColor=#000000;" edge="1" parent="4Kn29drxNQvWNtrvnITc-1" source="mh4P0uBNXgxFaoqxqVZ_-5" target="mh4P0uBNXgxFaoqxqVZ_-17">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-5" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;b&gt;FailSync&lt;/b&gt;&lt;/pre&gt;" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=16;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="910" y="2010" width="270" height="120" as="geometry">
            <mxRectangle x="920" y="820" width="150" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-6" value="boolean writerShouldBlock()" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;" vertex="1" parent="mh4P0uBNXgxFaoqxqVZ_-5">
          <mxGeometry y="26" width="270" height="26" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-7" value="boolean readerShouldBlock()" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;" vertex="1" parent="mh4P0uBNXgxFaoqxqVZ_-5">
          <mxGeometry y="52" width="270" height="26" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-8" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;ReadLock和WriteLock共用一个Sync 对象，ReentrantReadWriteLock内部&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;维护一个Sync对象，ReentrantLock内部也维护一个Sync对象，均继承AQS&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;public &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ReentrantReadWriteLock&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;fair&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;sync &lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;fair &lt;/span&gt;&lt;span&gt;? &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;new &lt;/span&gt;&lt;span&gt;FairSync&lt;/span&gt;&lt;span&gt;() &lt;/span&gt;&lt;span&gt;: &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;new &lt;/span&gt;&lt;span&gt;NonfairSync&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;readerLock &lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;new &lt;/span&gt;&lt;span&gt;ReadLock&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;this&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;writerLock &lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;new &lt;/span&gt;&lt;span&gt;WriteLock&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;this&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=none;fontSize=16;strokeColor=#000000;fillColor=#ffffff;align=left;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="820" y="740" width="650" height="230" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-9" value="同互斥锁一样，读写锁也是用state变量来表示锁状态的。只是state变量在这里的含义和互斥锁完全不同。在内部类Sync中，对state变量进行了重新定义，分高16位和低16位（一个int类型4个字节）" style="text;html=1;strokeColor=none;fillColor=none;align=left;verticalAlign=middle;whiteSpace=wrap;rounded=0;glass=0;labelBackgroundColor=none;fontSize=16;fontColor=#000000;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="1640" y="760" width="410" height="180" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;" edge="1" parent="4Kn29drxNQvWNtrvnITc-1" source="mh4P0uBNXgxFaoqxqVZ_-10" target="mh4P0uBNXgxFaoqxqVZ_-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-15" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=16;fontColor=#000000;" edge="1" parent="4Kn29drxNQvWNtrvnITc-1" source="mh4P0uBNXgxFaoqxqVZ_-10" target="mh4P0uBNXgxFaoqxqVZ_-12">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-10" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;abstract static class &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Sync &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;extends &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;AbstractQueuedSynchronizer &lt;/span&gt;&lt;span&gt;{&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private static final long &lt;/span&gt;&lt;span&gt;serialVersionUID &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;6317671515068378041L&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;/*&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;     *同互斥锁一样，读写锁也是用state变量来表示锁状态的。&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;     *只是state变量在这里的含义和互斥锁完全不同。&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;     *在内部类Sync中，对state变量进行了重新定义，分高16位和低16位（一个int类型4个字节）&lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * Read vs write count extraction constants and functions.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * Lock state is logically divided into two unsigned shorts:&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * The lower one representing the exclusive (writer) lock hold count,&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * and the upper the shared (reader) hold count.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static final int &lt;/span&gt;&lt;span&gt;SHARED_SHIFT   &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;16&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static final int &lt;/span&gt;&lt;span&gt;SHARED_UNIT    &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;1 &lt;/span&gt;&lt;span&gt;&amp;lt;&amp;lt; &lt;/span&gt;&lt;span&gt;SHARED_SHIFT)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static final int &lt;/span&gt;&lt;span&gt;MAX_COUNT      &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;1 &lt;/span&gt;&lt;span&gt;&amp;lt;&amp;lt; &lt;/span&gt;&lt;span&gt;SHARED_SHIFT) &lt;/span&gt;&lt;span&gt;- &lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static final int &lt;/span&gt;&lt;span&gt;EXCLUSIVE_MASK &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;1 &lt;/span&gt;&lt;span&gt;&amp;lt;&amp;lt; &lt;/span&gt;&lt;span&gt;SHARED_SHIFT) &lt;/span&gt;&lt;span&gt;- &lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;/** Returns the number of shared holds represented in count  */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;sharedCount&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;c&lt;/span&gt;&lt;span&gt;)    { &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;c &lt;/span&gt;&lt;span&gt;&amp;gt;&amp;gt;&amp;gt; &lt;/span&gt;&lt;span&gt;SHARED_SHIFT&lt;/span&gt;&lt;span&gt;; &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;/** Returns the number of exclusive holds represented in count  */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;exclusiveCount&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;c&lt;/span&gt;&lt;span&gt;) { &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;c &lt;/span&gt;&lt;span&gt;&amp;amp; &lt;/span&gt;&lt;span&gt;EXCLUSIVE_MASK&lt;/span&gt;&lt;span&gt;; &lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=16;strokeColor=#000000;fillColor=#ffffff;align=left;arcSize=7;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="800" y="1300" width="920" height="640" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-20" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=16;fontColor=#000000;" edge="1" parent="4Kn29drxNQvWNtrvnITc-1" source="mh4P0uBNXgxFaoqxqVZ_-12" target="mh4P0uBNXgxFaoqxqVZ_-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-12" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;b&gt;NonfailSync&lt;/b&gt;&lt;/pre&gt;" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=16;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="1380" y="2010" width="270" height="120" as="geometry">
            <mxRectangle x="920" y="820" width="150" height="26" as="alternateBounds" />
          </mxGeometry>
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-13" value="boolean writerShouldBlock()" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;" vertex="1" parent="mh4P0uBNXgxFaoqxqVZ_-12">
          <mxGeometry y="26" width="270" height="26" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-14" value="boolean readerShouldBlock()" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;fontSize=16;" vertex="1" parent="mh4P0uBNXgxFaoqxqVZ_-12">
          <mxGeometry y="52" width="270" height="26" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-17" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static final class &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;FairSync &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;extends &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Sync &lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;writerShouldBlock&lt;/span&gt;&lt;span&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span&gt;hasQueuedPredecessors&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;//该方法在AQS里实现，看当前线程是否处于队列头部&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;readerShouldBlock&lt;/span&gt;&lt;span&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span&gt;hasQueuedPredecessors&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=16;strokeColor=#000000;fillColor=#ffffff;align=left;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="450" y="2240" width="840" height="350" as="geometry" />
        </mxCell>
        <mxCell id="mh4P0uBNXgxFaoqxqVZ_-19" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static final class &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;NonfairSync &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;extends &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Sync &lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;writerShouldBlock&lt;/span&gt;&lt;span&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return false&lt;/span&gt;&lt;span&gt;; &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;// writers can always barge&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;readerShouldBlock&lt;/span&gt;&lt;span&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;/* As a heuristic to avoid indefinite writer starvation,&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * block if the thread that momentarily appears to be head&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * of queue, if one exists, is a waiting writer.  This is&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * only a probabilistic effect since a new reader will not&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * block if there is a waiting writer behind other enabled&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * readers that have not yet drained from the queue.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span&gt;apparentlyFirstQueuedIsExclusive&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=16;strokeColor=#000000;fillColor=#ffffff;align=left;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="1360" y="2250" width="805" height="460" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="J9Tmd6Zy7u8FUA9VIpDE" name="第 2 页">
    <mxGraphModel dx="2514" dy="1325" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="8500" pageHeight="20000" math="0" shadow="0">
      <root>
        <mxCell id="tAtp5M9JWyRdrx9-1-cH-0" />
        <mxCell id="tAtp5M9JWyRdrx9-1-cH-1" parent="tAtp5M9JWyRdrx9-1-cH-0" />
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-0" value="Object" style="html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=2;fontFamily=Verdana;fontSize=12;align=center;shape=mxgraph.ios7ui.horLines;" vertex="1" parent="tAtp5M9JWyRdrx9-1-cH-1">
          <mxGeometry x="1272.5" y="656" width="135" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-1" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" vertex="1" parent="tAtp5M9JWyRdrx9-1-cH-1">
          <mxGeometry x="1260" y="290" width="160" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-2" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-3" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-1">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-4" value="Row 3" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-1">
          <mxGeometry y="78" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-5" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" vertex="1" parent="tAtp5M9JWyRdrx9-1-cH-1">
          <mxGeometry x="1660" y="290" width="160" height="130" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-6" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-5">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-7" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-5">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-8" value="Row 3" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-5">
          <mxGeometry y="78" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-9" value="Row 4" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-5">
          <mxGeometry y="104" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-10" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" vertex="1" parent="tAtp5M9JWyRdrx9-1-cH-1">
          <mxGeometry x="1260" y="482" width="160" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-11" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-10">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-12" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-10">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-13" value="Row 3" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-10">
          <mxGeometry y="78" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-14" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" vertex="1" parent="tAtp5M9JWyRdrx9-1-cH-1">
          <mxGeometry x="1260" y="786" width="160" height="140" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-15" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-14">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-16" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-14">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-17" value="Row 3" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-14">
          <mxGeometry y="78" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-18" value="Row 4" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-14">
          <mxGeometry y="104" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-19" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" vertex="1" parent="tAtp5M9JWyRdrx9-1-cH-1">
          <mxGeometry x="1660" y="482" width="160" height="84" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-20" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-19">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-21" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-19">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-22" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" vertex="1" parent="tAtp5M9JWyRdrx9-1-cH-1">
          <mxGeometry x="1660" y="786" width="160" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-23" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-22">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-24" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-22">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-25" value="Row 3" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" vertex="1" parent="AeLNYvw3zZ7ImW0hco7L-22">
          <mxGeometry y="78" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-26" value="Object" style="html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=2;fontFamily=Verdana;fontSize=12;align=center;shape=mxgraph.ios7ui.horLines;" vertex="1" parent="tAtp5M9JWyRdrx9-1-cH-1">
          <mxGeometry x="1480" y="656" width="135" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-27" style="edgeStyle=none;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-14" target="AeLNYvw3zZ7ImW0hco7L-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-28" style="edgeStyle=none;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-0" target="AeLNYvw3zZ7ImW0hco7L-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-29" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;exitX=1;exitY=0.25;entryX=1;entryY=0.5;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-14" target="AeLNYvw3zZ7ImW0hco7L-13">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1450" y="821" />
              <mxPoint x="1450" y="573" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-30" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-26" target="AeLNYvw3zZ7ImW0hco7L-23">
          <mxGeometry x="-0.1342" y="32" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-31" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-10" target="AeLNYvw3zZ7ImW0hco7L-26">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1548" y="556" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-32" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-1" target="AeLNYvw3zZ7ImW0hco7L-10">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-33" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-22" target="AeLNYvw3zZ7ImW0hco7L-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-34" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-5" target="AeLNYvw3zZ7ImW0hco7L-19">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-35" style="edgeStyle=orthogonalEdgeStyle;html=1;entryX=0;entryY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;exitX=1;exitY=0.5;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-3" target="AeLNYvw3zZ7ImW0hco7L-7">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-36" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=0;exitY=0.5;entryX=1;entryY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-6" target="AeLNYvw3zZ7ImW0hco7L-2">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-37" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-4" target="AeLNYvw3zZ7ImW0hco7L-20">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-38" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-12" target="AeLNYvw3zZ7ImW0hco7L-21">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-39" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-21">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="547" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-40" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-23">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="825" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-41" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;entryX=1;entryY=0.5;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" target="AeLNYvw3zZ7ImW0hco7L-24">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1990" y="835" as="targetPoint" />
            <mxPoint x="1980" y="851" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="1980" y="851" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-42" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;entryX=1;entryY=0.5;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" target="AeLNYvw3zZ7ImW0hco7L-25">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1830.1904761904761" y="861.0952380952381" as="targetPoint" />
            <mxPoint x="1980" y="877" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="1900" y="877" />
              <mxPoint x="1900" y="877" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-43" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-6">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="329" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-44" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-7">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="355" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-45" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-8">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="381" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-46" style="edgeStyle=elbowEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;elbow=vertical;entryX=1.011;entryY=0.152;entryPerimeter=0;" edge="1" parent="tAtp5M9JWyRdrx9-1-cH-1" target="AeLNYvw3zZ7ImW0hco7L-5">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1840" y="305" as="targetPoint" />
            <mxPoint x="1980" y="310" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="1910" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
