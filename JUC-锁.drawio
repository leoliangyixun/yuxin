<mxfile host="app.diagrams.net" modified="2021-07-15T15:09:40.957Z" agent="5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/91.0.4472.114 Safari/537.36" etag="kq2KgMDWhdyA0u2z-pnK" version="14.8.4" type="github" pages="7">
  <diagram id="J9Tmd6Zy7u8FUA9VIpDE" name="模板">
    <mxGraphModel dx="2514" dy="1325" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="8500" pageHeight="20000" math="0" shadow="0">
      <root>
        <mxCell id="tAtp5M9JWyRdrx9-1-cH-0" />
        <mxCell id="tAtp5M9JWyRdrx9-1-cH-1" parent="tAtp5M9JWyRdrx9-1-cH-0" />
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-0" value="Object" style="html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=2;fontFamily=Verdana;fontSize=12;align=center;shape=mxgraph.ios7ui.horLines;" parent="tAtp5M9JWyRdrx9-1-cH-1" vertex="1">
          <mxGeometry x="1272.5" y="656" width="135" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-1" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" parent="tAtp5M9JWyRdrx9-1-cH-1" vertex="1">
          <mxGeometry x="1260" y="290" width="160" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-2" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-1" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-3" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-1" vertex="1">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-4" value="Row 3" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-1" vertex="1">
          <mxGeometry y="78" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-5" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" parent="tAtp5M9JWyRdrx9-1-cH-1" vertex="1">
          <mxGeometry x="1660" y="290" width="160" height="130" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-6" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-5" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-7" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-5" vertex="1">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-8" value="Row 3" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-5" vertex="1">
          <mxGeometry y="78" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-9" value="Row 4" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-5" vertex="1">
          <mxGeometry y="104" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-10" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" parent="tAtp5M9JWyRdrx9-1-cH-1" vertex="1">
          <mxGeometry x="1260" y="482" width="160" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-11" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-10" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-12" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-10" vertex="1">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-13" value="Row 3" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-10" vertex="1">
          <mxGeometry y="78" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-14" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" parent="tAtp5M9JWyRdrx9-1-cH-1" vertex="1">
          <mxGeometry x="1260" y="786" width="160" height="140" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-15" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-14" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-16" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-14" vertex="1">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-17" value="Row 3" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-14" vertex="1">
          <mxGeometry y="78" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-18" value="Row 4" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-14" vertex="1">
          <mxGeometry y="104" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-19" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" parent="tAtp5M9JWyRdrx9-1-cH-1" vertex="1">
          <mxGeometry x="1660" y="482" width="160" height="84" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-20" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-19" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-21" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-19" vertex="1">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-22" value="Function" style="swimlane;html=1;fontStyle=0;childLayout=stackLayout;horizontal=1;startSize=26;fillColor=#e0e0e0;horizontalStack=0;resizeParent=1;resizeLast=0;collapsible=1;marginBottom=0;swimlaneFillColor=#ffffff;align=center;rounded=1;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=1;fontFamily=Verdana;fontSize=12" parent="tAtp5M9JWyRdrx9-1-cH-1" vertex="1">
          <mxGeometry x="1660" y="786" width="160" height="110" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-23" value="Row 1" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-22" vertex="1">
          <mxGeometry y="26" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-24" value="Row 2" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-22" vertex="1">
          <mxGeometry y="52" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-25" value="Row 3" style="text;html=1;strokeColor=none;fillColor=none;spacingLeft=4;spacingRight=4;whiteSpace=wrap;overflow=hidden;rotatable=0;points=[[0,0.5],[1,0.5]];portConstraint=eastwest;" parent="AeLNYvw3zZ7ImW0hco7L-22" vertex="1">
          <mxGeometry y="78" width="160" height="26" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-26" value="Object" style="html=1;rounded=0;shadow=0;comic=0;labelBackgroundColor=none;strokeWidth=2;fontFamily=Verdana;fontSize=12;align=center;shape=mxgraph.ios7ui.horLines;" parent="tAtp5M9JWyRdrx9-1-cH-1" vertex="1">
          <mxGeometry x="1480" y="656" width="135" height="50" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-27" style="edgeStyle=none;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-14" target="AeLNYvw3zZ7ImW0hco7L-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-28" style="edgeStyle=none;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-0" target="AeLNYvw3zZ7ImW0hco7L-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-29" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;exitX=1;exitY=0.25;entryX=1;entryY=0.5;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-14" target="AeLNYvw3zZ7ImW0hco7L-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1450" y="821" />
              <mxPoint x="1450" y="573" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-30" value="" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-26" target="AeLNYvw3zZ7ImW0hco7L-23" edge="1">
          <mxGeometry x="-0.1342" y="32" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-31" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-10" target="AeLNYvw3zZ7ImW0hco7L-26" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1548" y="556" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-32" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-1" target="AeLNYvw3zZ7ImW0hco7L-10" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-33" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-22" target="AeLNYvw3zZ7ImW0hco7L-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-34" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-5" target="AeLNYvw3zZ7ImW0hco7L-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-35" style="edgeStyle=orthogonalEdgeStyle;html=1;entryX=0;entryY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;exitX=1;exitY=0.5;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-3" target="AeLNYvw3zZ7ImW0hco7L-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-36" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=0;exitY=0.5;entryX=1;entryY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-6" target="AeLNYvw3zZ7ImW0hco7L-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-37" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-4" target="AeLNYvw3zZ7ImW0hco7L-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-38" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;entryX=0;entryY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-12" target="AeLNYvw3zZ7ImW0hco7L-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-39" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="547" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-40" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-23" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="825" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-41" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;entryX=1;entryY=0.5;" parent="tAtp5M9JWyRdrx9-1-cH-1" target="AeLNYvw3zZ7ImW0hco7L-24" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1990" y="835" as="targetPoint" />
            <mxPoint x="1980" y="851" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="1980" y="851" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-42" style="edgeStyle=orthogonalEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;entryX=1;entryY=0.5;" parent="tAtp5M9JWyRdrx9-1-cH-1" target="AeLNYvw3zZ7ImW0hco7L-25" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1830.1904761904761" y="861.0952380952381" as="targetPoint" />
            <mxPoint x="1980" y="877" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="1900" y="877" />
              <mxPoint x="1900" y="877" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-43" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="329" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-44" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-7" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="355" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-45" style="edgeStyle=orthogonalEdgeStyle;html=1;exitX=1;exitY=0.5;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;" parent="tAtp5M9JWyRdrx9-1-cH-1" source="AeLNYvw3zZ7ImW0hco7L-8" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1980" y="381" as="targetPoint" />
            <Array as="points" />
          </mxGeometry>
        </mxCell>
        <mxCell id="AeLNYvw3zZ7ImW0hco7L-46" style="edgeStyle=elbowEdgeStyle;html=1;labelBackgroundColor=none;startFill=0;startSize=8;endFill=1;endSize=8;fontFamily=Verdana;fontSize=12;elbow=vertical;entryX=1.011;entryY=0.152;entryPerimeter=0;" parent="tAtp5M9JWyRdrx9-1-cH-1" target="AeLNYvw3zZ7ImW0hco7L-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1840" y="305" as="targetPoint" />
            <mxPoint x="1980" y="310" as="sourcePoint" />
            <Array as="points">
              <mxPoint x="1910" y="310" />
            </Array>
          </mxGeometry>
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram name="互斥锁" id="5d7acffa-a066-3a61-03fe-96351882024d">
    <mxGraphModel dx="2514" dy="1325" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="3000" pageHeight="3000" background="#ffffff" math="0" shadow="1">
      <root>
        <mxCell id="0" />
        <mxCell id="1" parent="0" />
        <mxCell id="CqtvCm25UIUQusRmt474-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;fontSize=16;" parent="1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1349" y="604" as="sourcePoint" />
            <mxPoint x="429" y="737" as="targetPoint" />
            <Array as="points">
              <mxPoint x="1349" y="657" />
              <mxPoint x="429" y="657" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-6" value="&lt;pre style=&quot;text-align: left ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;tryAcquire()&lt;/span&gt;&lt;/pre&gt;公平实现方式" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontColor=#000000;" parent="CqtvCm25UIUQusRmt474-23" vertex="1" connectable="0">
          <mxGeometry x="0.5831" y="-2" relative="1" as="geometry">
            <mxPoint x="283" y="5" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-27" value="&lt;pre style=&quot;text-align: left ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;tryAcquire()&lt;/span&gt;&lt;/pre&gt;非公平实现方式" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;fontSize=16;" parent="1" source="CqtvCm25UIUQusRmt474-13" target="CqtvCm25UIUQusRmt474-26" edge="1">
          <mxGeometry x="-0.3252" relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1349" y="657" />
              <mxPoint x="2254" y="657" />
            </Array>
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;entryX=0.482;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="CqtvCm25UIUQusRmt474-13" target="CqtvCm25UIUQusRmt474-30" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1349" y="1209" />
              <mxPoint x="863" y="1209" />
              <mxPoint x="863" y="1469" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-8" value="&lt;pre style=&quot;text-align: left; background-color: rgb(248, 249, 250); font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;b style=&quot;font-size: 16px;&quot;&gt;acquireQueued()&lt;/b&gt;&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontColor=#000000;" parent="krwOEIBx-vB3lfnVqGeh-7" vertex="1" connectable="0">
          <mxGeometry x="0.177" y="1" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="fj6ui93SYAHTBFZENV5a-5" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=16;fontColor=#000000;" edge="1" parent="1" source="CqtvCm25UIUQusRmt474-13" target="fj6ui93SYAHTBFZENV5a-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1349" y="1210" />
              <mxPoint x="1890" y="1210" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="fj6ui93SYAHTBFZENV5a-6" value="&lt;pre style=&quot;text-align: left; font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;addWaiter()&lt;/span&gt;&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="fj6ui93SYAHTBFZENV5a-5">
          <mxGeometry x="0.1079" y="1" relative="1" as="geometry">
            <mxPoint x="71" y="-2" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-13" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;public final void &lt;/span&gt;acquire(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;arg) {//模板方法，tryAcquire()由子类负责实现&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(!tryAcquire(arg) &amp;amp;&amp;amp;&lt;br style=&quot;font-size: 16px;&quot;&gt;        acquireQueued(addWaiter(Node.EXCLUSIVE), arg))&lt;font color=&quot;#cc0000&quot; style=&quot;font-size: 16px;&quot;&gt;//返回是否被中断&lt;/font&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;        selfInterrupt();&lt;br style=&quot;font-size: 16px;&quot;&gt;}&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;fontColor=#000000;align=left;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="960" y="469" width="778" height="133" as="geometry" />
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-18" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;fontSize=16;" parent="1" source="CqtvCm25UIUQusRmt474-14" target="CqtvCm25UIUQusRmt474-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1074" y="360" />
              <mxPoint x="1300" y="360" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-14" value="&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px; font-weight: bold;&quot;&gt;final void &lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px; font-weight: bold; font-style: italic;&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;() {&lt;/span&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;acquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=none;align=left;arcSize=9;labelBorderColor=none;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="965" y="125" width="232" height="107" as="geometry" />
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-21" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontColor=#000000;fontSize=16;" parent="1" source="CqtvCm25UIUQusRmt474-19" target="CqtvCm25UIUQusRmt474-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1597" y="362" />
              <mxPoint x="1300" y="362" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-19" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;final void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;() {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;compareAndSetState&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;))//立即抢锁&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;setExclusiveOwnerThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;currentThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;())&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;else&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;acquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;//抢锁失败，&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;align=left;arcSize=8;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="1360" y="129" width="580" height="180" as="geometry" />
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-22" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;tryAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;currentThread&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;getState&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;== &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;!&lt;/span&gt;&lt;span&gt;hasQueuedPredecessors&lt;/span&gt;&lt;span&gt;() &lt;/span&gt;&lt;span&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span&gt;compareAndSetState&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span&gt;)) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span&gt;setExclusiveOwnerThread&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    }&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current &lt;/span&gt;&lt;span&gt;== &lt;/span&gt;&lt;span&gt;getExclusiveOwnerThread&lt;/span&gt;&lt;span&gt;()) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span&gt;+ &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc &lt;/span&gt;&lt;span&gt;&amp;lt; &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;)&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;throw new &lt;/span&gt;&lt;span&gt;Error&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;&quot;Maximum lock count exceeded&quot;&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;setState&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return false&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;align=left;arcSize=7;" parent="1" vertex="1">
          <mxGeometry x="40" y="735" width="777" height="425" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;" parent="1" source="CqtvCm25UIUQusRmt474-26" target="krwOEIBx-vB3lfnVqGeh-4" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-26" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;tryAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;nonfairTryAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/pre&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;strokeColor=#000000;align=left;arcSize=3;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="1988" y="737" width="523" height="138" as="geometry" />
        </mxCell>
        <mxCell id="zHQmcre7dR3sZDUqDH8s-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;" edge="1" parent="1" source="CqtvCm25UIUQusRmt474-30" target="zHQmcre7dR3sZDUqDH8s-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="886" y="2177" />
              <mxPoint x="464" y="2177" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="zHQmcre7dR3sZDUqDH8s-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;" edge="1" parent="1" source="CqtvCm25UIUQusRmt474-30" target="zHQmcre7dR3sZDUqDH8s-2">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="886" y="2178" />
              <mxPoint x="1259" y="2178" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="CqtvCm25UIUQusRmt474-30" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;b style=&quot;font-size: 16px&quot;&gt;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px&quot;&gt;这个方法只有抢到锁之后才会返回,&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;font face=&quot;pt mono&quot; color=&quot;#ea6b66&quot; style=&quot;font-size: 16px&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;&lt;b style=&quot;font-size: 16px&quot;&gt;该函数不会中断响应，但它会记录被阻塞期间有没有其他线程向它发送过中断信号;如果被中断,&lt;br style=&quot;font-size: 16px&quot;&gt;则该函数会返回true;否则,返回false&lt;/b&gt;&lt;/span&gt;&lt;/font&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;acquireQueued&lt;/span&gt;(&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;node&lt;/span&gt;, &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;arg&lt;/span&gt;) {&lt;br style=&quot;font-size: 16px&quot;&gt;    &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;failed &lt;/span&gt;= &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;true&lt;/span&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;    &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;try &lt;/span&gt;{&lt;br style=&quot;font-size: 16px&quot;&gt;        &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;interrupted &lt;/span&gt;= &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;false&lt;/span&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;        &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;for &lt;/span&gt;(;;) {&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px&quot;&gt;//不断去拿锁&lt;/font&gt;&lt;br style=&quot;font-size: 16px&quot;&gt;            &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;p &lt;/span&gt;= &lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;node&lt;/span&gt;.predecessor();&lt;font color=&quot;#ea6b66&quot;&gt;//取当前节点前置节点&lt;/font&gt;&lt;br style=&quot;font-size: 16px&quot;&gt;            &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;p &lt;/span&gt;== head &amp;amp;&amp;amp; tryAcquire(&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;arg&lt;/span&gt;)) {&lt;font color=&quot;#ea6b66&quot;&gt;//如果当前节点的前置节点是头结点并且获取锁&lt;/font&gt;&lt;br style=&quot;font-size: 16px&quot;&gt;                setHead(&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;node&lt;/span&gt;);&lt;br style=&quot;font-size: 16px&quot;&gt;                &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;p&lt;/span&gt;.next = &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;null&lt;/span&gt;; &lt;span style=&quot;font-style: italic ; font-size: 16px&quot;&gt;// help GC&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 16px&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;failed &lt;/span&gt;= &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;false&lt;/span&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;                &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;interrupted&lt;/span&gt;;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px&quot;&gt;//获取锁之后，返回&lt;/font&gt;&lt;br style=&quot;font-size: 16px&quot;&gt;            }&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt; &lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px&quot;&gt;           //不断拿锁的过程中需要判断是否需要阻塞&lt;/font&gt;&lt;br style=&quot;font-size: 16px&quot;&gt;            &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;if &lt;/span&gt;(shouldParkAfterFailedAcquire(&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;p&lt;/span&gt;, &lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;node&lt;/span&gt;) &amp;amp;&amp;amp; parkAndCheckInterrupt()){&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;                &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;interrupted &lt;/span&gt;= &lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;true&lt;/span&gt;;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt; &lt;/span&gt;           }&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;}&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;    } &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;finally &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;{&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;failed&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;)&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;cancelAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;}&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;pre style=&quot;font-size: 16px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=none;strokeColor=#000000;fillColor=#ffffff;align=left;arcSize=5;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="478" y="1470" width="815" height="628" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=30;fontColor=#000000;" parent="1" target="CqtvCm25UIUQusRmt474-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="1081" y="59" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="_KA6L-gr-Qn6RJLEGgCv-1" value="公平锁" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;glass=0;labelBackgroundColor=none;fontColor=#000000;fontSize=30;" parent="1" vertex="1">
          <mxGeometry x="713" y="20" width="150" height="20" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-3" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=30;fontColor=#000000;" parent="1" source="_KA6L-gr-Qn6RJLEGgCv-2" target="CqtvCm25UIUQusRmt474-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="_KA6L-gr-Qn6RJLEGgCv-2" value="&lt;span style=&quot;text-align: left; font-size: 30px;&quot;&gt;非公平锁&lt;/span&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;glass=0;labelBackgroundColor=none;fontColor=#000000;fontSize=30;" parent="1" vertex="1">
          <mxGeometry x="1575" y="46" width="150" height="17" as="geometry" />
        </mxCell>
        <mxCell id="krwOEIBx-vB3lfnVqGeh-4" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-size: 16px; white-space: normal; font-weight: bold;&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-size: 16px; white-space: normal; font-weight: bold; font-style: italic;&quot;&gt;nonfairTryAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px; white-space: normal;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px; white-space: normal; font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-size: 16px; white-space: normal; font-weight: bold; font-style: italic;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px; white-space: normal;&quot;&gt;) {&lt;/span&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;current &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;currentThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;getState&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;compareAndSetState&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;setExclusiveOwnerThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return true&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    }&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;current &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;getExclusiveOwnerThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;()) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;nextc &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;+ &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;nextc &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;// overflow&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;Error&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&quot;Maximum lock count exceeded&quot;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;setState&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;nextc&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return true&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return false&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;strokeColor=#000000;align=left;arcSize=3;fontSize=16;" parent="1" vertex="1">
          <mxGeometry x="1932" y="965" width="635" height="453" as="geometry" />
        </mxCell>
        <mxCell id="0hTYx7RgD9tuDB6i6g-k-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.513;entryY=-0.003;entryDx=0;entryDy=0;entryPerimeter=0;fontColor=#000000;fontSize=16;" parent="1" source="0hTYx7RgD9tuDB6i6g-k-5" target="0hTYx7RgD9tuDB6i6g-k-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0hTYx7RgD9tuDB6i6g-k-2" value="&lt;pre style=&quot;text-align: left; font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;unparkSuccessor()&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;fontSize=16;" parent="0hTYx7RgD9tuDB6i6g-k-1" vertex="1" connectable="0">
          <mxGeometry x="-0.311" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0hTYx7RgD9tuDB6i6g-k-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontColor=#000000;fontSize=16;" parent="1" source="0hTYx7RgD9tuDB6i6g-k-5" target="0hTYx7RgD9tuDB6i6g-k-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0hTYx7RgD9tuDB6i6g-k-4" value="&lt;pre style=&quot;text-align: left; font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;tryRelease()&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontColor=#000000;fontSize=16;" parent="0hTYx7RgD9tuDB6i6g-k-3" vertex="1" connectable="0">
          <mxGeometry x="0.1688" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0hTYx7RgD9tuDB6i6g-k-5" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;public final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;release&lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;arg&lt;/span&gt;) {&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;//模板方法&lt;/font&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(tryRelease(&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;arg&lt;/span&gt;)) {&lt;br style=&quot;font-size: 16px;&quot;&gt;        &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;h &lt;/span&gt;= head;&lt;br style=&quot;font-size: 16px;&quot;&gt;        &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;h &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;null &lt;/span&gt;&amp;amp;&amp;amp; &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;h&lt;/span&gt;.waitStatus != 0)&lt;br style=&quot;font-size: 16px;&quot;&gt;            unparkSuccessor(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;h&lt;/span&gt;);&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;//唤醒队列中的其他线程;&lt;/font&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;        &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return true&lt;/span&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;    }&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return false&lt;/span&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;}&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=16;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;align=left;" parent="1" vertex="1">
          <mxGeometry x="3494" y="155" width="540" height="240" as="geometry" />
        </mxCell>
        <mxCell id="0hTYx7RgD9tuDB6i6g-k-6" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;tryRelease&lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;releases&lt;/span&gt;) {&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;= getState() - &lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;releases&lt;/span&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Thread&lt;/span&gt;.currentThread() != getExclusiveOwnerThread())&lt;br style=&quot;font-size: 16px;&quot;&gt;        &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;throw new &lt;/span&gt;IllegalMonitorStateException();&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;//不是持有锁的线程释放&lt;/font&gt;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;直接报错&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;free &lt;/span&gt;= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;false&lt;/span&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;== 0) {&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;//每调用一次，state减1，直到为0，才表示锁释放成功&lt;/font&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;        &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;free &lt;/span&gt;= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;true&lt;/span&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;        setExclusiveOwnerThread(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;null&lt;/span&gt;);&lt;br style=&quot;font-size: 16px;&quot;&gt;    }&lt;/pre&gt;&lt;pre style=&quot;font-size: 16px&quot;&gt;&lt;font face=&quot;pt mono&quot; style=&quot;font-size: 16px&quot; color=&quot;#ea6b66&quot;&gt;因为是排他锁，只有已经持有锁的线程才有资格调用release（..），这意味着没有其他线程与它争抢。&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot; color=&quot;#ea6b66&quot;&gt;所以，在上面的tryRelease（..）函数中，对state值的修改，不需要CAS操作，直接减1即可；&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot; color=&quot;#ea6b66&quot;&gt;注意，加锁和解锁必须成对出现&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 16px&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;b style=&quot;font-size: 16px;&quot;&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;setState&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;/b&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;b style=&quot;font-size: 16px;&quot;&gt;;&lt;/b&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-weight: bold; font-size: 16px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-weight: bold; font-size: 16px;&quot;&gt;free&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;}&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=16;strokeColor=#000000;fillColor=#ffffff;align=left;labelBorderColor=none;arcSize=9;" parent="1" vertex="1">
          <mxGeometry x="3004" y="580" width="800" height="490" as="geometry" />
        </mxCell>
        <mxCell id="0hTYx7RgD9tuDB6i6g-k-7" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;唤醒队列中的其他线程&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;unparkSuccessor&lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;node&lt;/span&gt;) {&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;/*&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;     * If status is negative (i.e., possibly needing signal) try&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;     * to clear in anticipation of signalling.  It is OK if this&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;     * fails or if status is changed by waiting thread.&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;     */&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;ws &lt;/span&gt;= &lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;node&lt;/span&gt;.waitStatus;&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;ws &lt;/span&gt;&amp;lt; 0)&lt;br style=&quot;font-size: 16px;&quot;&gt;        compareAndSetWaitStatus(&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;node&lt;/span&gt;, &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;ws&lt;/span&gt;, 0);&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;/*&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;     * Thread to unpark is held in successor, which is normally&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;     * just the next node.  But if cancelled or apparently null,&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;     * traverse backwards from tail to find the actual&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;     * non-cancelled successor.&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;     */&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;s &lt;/span&gt;= &lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;node&lt;/span&gt;.next;&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;s &lt;/span&gt;== &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;null &lt;/span&gt;|| &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;s&lt;/span&gt;.waitStatus &amp;gt; 0) {&lt;br style=&quot;font-size: 16px;&quot;&gt;        &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;s &lt;/span&gt;= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;null&lt;/span&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;        &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;for &lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;t &lt;/span&gt;= tail; &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;t &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;null &lt;/span&gt;&amp;amp;&amp;amp; &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;t &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;node&lt;/span&gt;; &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;t &lt;/span&gt;= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;t&lt;/span&gt;.prev)&lt;br style=&quot;font-size: 16px;&quot;&gt;            &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;t&lt;/span&gt;.waitStatus &amp;lt;= 0)&lt;br style=&quot;font-size: 16px;&quot;&gt;                &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;s &lt;/span&gt;= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;t&lt;/span&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;    }&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;s &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;null&lt;/span&gt;)&lt;br style=&quot;font-size: 16px;&quot;&gt;        &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;LockSupport&lt;/span&gt;.unpark(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;s&lt;/span&gt;.thread);&lt;font color=&quot;#ff0080&quot; style=&quot;font-size: 16px;&quot;&gt;//唤醒下一个在等待队列里阻塞的线程&lt;br style=&quot;font-size: 16px;&quot;&gt;}&lt;/font&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=16;strokeColor=#000000;fillColor=#ffffff;align=left;arcSize=9;" parent="1" vertex="1">
          <mxGeometry x="3884" y="580" width="720" height="680" as="geometry" />
        </mxCell>
        <mxCell id="0hTYx7RgD9tuDB6i6g-k-8" value="&lt;span style=&quot;text-align: center ; background-color: rgb(248 , 249 , 250)&quot;&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;解锁不区分公平与非公平&lt;/font&gt;&lt;/span&gt;" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.cloud_callout;labelBackgroundColor=#ffffff;fontSize=18;fontColor=#000000;align=left;" parent="1" vertex="1">
          <mxGeometry x="4034" y="85" width="220" height="90" as="geometry" />
        </mxCell>
        <mxCell id="0hTYx7RgD9tuDB6i6g-k-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.48;entryY=-0.004;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=30;fontColor=#000000;" parent="1" target="0hTYx7RgD9tuDB6i6g-k-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3752.5" y="59" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="0hTYx7RgD9tuDB6i6g-k-9" value="释放锁" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;shadow=1;glass=1;labelBackgroundColor=#ffffff;sketch=0;fontColor=#000000;fontSize=30;" parent="1" vertex="1">
          <mxGeometry x="3692" y="29" width="133" height="24" as="geometry" />
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-23" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=30;fontColor=#000000;entryX=0.509;entryY=0.008;entryDx=0;entryDy=0;entryPerimeter=0;" parent="1" source="uPMalCJJjGVY2yAxwgIe-12" target="uPMalCJJjGVY2yAxwgIe-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="6052.5" y="157" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-12" value="中断锁" style="text;whiteSpace=wrap;html=1;fontSize=30;fontColor=#000000;" parent="1" vertex="1">
          <mxGeometry x="6000" y="40" width="106" height="43" as="geometry" />
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-24" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;" parent="1" source="uPMalCJJjGVY2yAxwgIe-13" target="uPMalCJJjGVY2yAxwgIe-19" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-13" value="&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;lock（）不能被中断，lockInterruptibly（）可以被中断；lock（）必须等被中断的线程获取锁之后才能响应中断&lt;/font&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/font&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;lockInterruptibly&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;() &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;InterruptedException &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;{&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;sync&lt;span style=&quot;font-size: 16px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;acquireInterruptibly&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=16;strokeColor=#000000;fillColor=#ffffff;align=left;" parent="1" vertex="1">
          <mxGeometry x="5681" y="165" width="730" height="240" as="geometry" />
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;exitX=0;exitY=0.5;exitDx=0;exitDy=0;" parent="1" source="uPMalCJJjGVY2yAxwgIe-19" target="uPMalCJJjGVY2yAxwgIe-21" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5491" y="584" />
              <mxPoint x="5491" y="414" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-15" value="公平" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontColor=#000000;" parent="uPMalCJJjGVY2yAxwgIe-14" vertex="1" connectable="0">
          <mxGeometry x="0.3526" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;" parent="1" source="uPMalCJJjGVY2yAxwgIe-19" target="uPMalCJJjGVY2yAxwgIe-22" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="5491" y="584" />
              <mxPoint x="5491" y="934" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-17" value="非公平" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontColor=#000000;" parent="uPMalCJJjGVY2yAxwgIe-16" vertex="1" connectable="0">
          <mxGeometry x="-0.0879" y="-2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.488;entryY=-0.004;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=16;fontColor=#000000;" parent="1" source="uPMalCJJjGVY2yAxwgIe-19" target="uPMalCJJjGVY2yAxwgIe-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-19" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;public final void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquireInterruptibly&lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;arg&lt;/span&gt;) &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;InterruptedException &lt;/span&gt;{&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Thread&lt;/span&gt;.interrupted())&lt;br style=&quot;font-size: 16px;&quot;&gt;        &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;throw new &lt;/span&gt;InterruptedException();&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;//如果当前线程被中断了，直接抛中断异常&lt;/font&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(!tryAcquire(&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;arg&lt;/span&gt;))&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;//这里和lock()里的实现一样&lt;/font&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;        doAcquireInterruptibly(&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;arg&lt;/span&gt;);&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;//和lock()里的&lt;/font&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;acquireQueued()&lt;b style=&quot;font-size: 16px;&quot;&gt;实现一样&lt;/b&gt;&lt;/font&gt;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;}&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=16;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;align=left;" parent="1" vertex="1">
          <mxGeometry x="5645.5" y="482" width="801" height="193" as="geometry" />
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-20" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;pre style=&quot;font-size: 16px; font-family: &amp;quot;pt mono&amp;quot;;&quot;&gt;&lt;b style=&quot;font-size: 16px;&quot;&gt;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;//和acquireQueued()实现一样，唯一的区别是返回布尔值还是抛异常&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-size: 16px; font-weight: bold;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;font-size: 16px; font-weight: bold; font-style: italic;&quot;&gt;doAcquireInterruptibly&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px; font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-size: 16px; font-weight: bold; font-style: italic;&quot;&gt;arg&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 16px; font-weight: bold;&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-size: 16px; font-weight: bold;&quot;&gt;InterruptedException &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;{&lt;/span&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;node &lt;/span&gt;= addWaiter(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Node&lt;/span&gt;.EXCLUSIVE);&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;failed &lt;/span&gt;= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;true&lt;/span&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;    &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;try &lt;/span&gt;{&lt;br style=&quot;font-size: 16px;&quot;&gt;        &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;for &lt;/span&gt;(;;) {&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px;&quot;&gt;//不断去拿锁&lt;/font&gt;&lt;br style=&quot;font-size: 16px;&quot;&gt;            &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;p &lt;/span&gt;= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;node&lt;/span&gt;.predecessor();&lt;br style=&quot;font-size: 16px;&quot;&gt;            &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;p &lt;/span&gt;== head &amp;amp;&amp;amp; tryAcquire(&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;arg&lt;/span&gt;)) {&lt;br style=&quot;font-size: 16px;&quot;&gt;                setHead(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;node&lt;/span&gt;);&lt;br style=&quot;font-size: 16px;&quot;&gt;                &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;p&lt;/span&gt;.next = &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;null&lt;/span&gt;; &lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;// help GC&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;failed &lt;/span&gt;= &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;false&lt;/span&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;                &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return&lt;/span&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;            }&lt;br style=&quot;font-size: 16px;&quot;&gt;            &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;(shouldParkAfterFailedAcquire(&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;p&lt;/span&gt;, &lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;node&lt;/span&gt;) &amp;amp;&amp;amp;&lt;br style=&quot;font-size: 16px;&quot;&gt;                parkAndCheckInterrupt())&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;InterruptedException&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    } &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;finally &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;{&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;failed&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;cancelAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=none;fontSize=16;strokeColor=#000000;fillColor=#ffffff;align=left;arcSize=9;" parent="1" vertex="1">
          <mxGeometry x="5655" y="784" width="800" height="570" as="geometry" />
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-21" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;tryAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;current &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;currentThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;getState&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;hasQueuedPredecessors&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;() &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;compareAndSetState&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;setExclusiveOwnerThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return true&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    }&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;current &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;getExclusiveOwnerThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;()) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;nextc &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;+ &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;nextc &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;Error&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&quot;Maximum lock count exceeded&quot;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;setState&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;nextc&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return true&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return false&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=16;align=left;arcSize=6;" parent="1" vertex="1">
          <mxGeometry x="4701" y="174" width="610" height="450" as="geometry" />
        </mxCell>
        <mxCell id="uPMalCJJjGVY2yAxwgIe-22" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;tryAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;nonfairTryAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 16px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;nonfairTryAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;current &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;currentThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;getState&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;compareAndSetState&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;setExclusiveOwnerThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return true&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    }&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;current &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;getExclusiveOwnerThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;()) {&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;nextc &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;+ &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 16px;&quot;&gt;acquires&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;nextc &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;// overflow&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 16px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;Error&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;&quot;Maximum lock count exceeded&quot;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;setState&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;nextc&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return true&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 16px;&quot;&gt;return false&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;;&lt;br style=&quot;font-size: 16px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=16;align=left;arcSize=7;" parent="1" vertex="1">
          <mxGeometry x="4701" y="664" width="610" height="520" as="geometry" />
        </mxCell>
        <mxCell id="zHQmcre7dR3sZDUqDH8s-1" value="&lt;pre style=&quot;font-style: normal ; font-weight: 400 ; letter-spacing: normal ; text-align: left ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; font-family: &amp;quot;pt mono&amp;quot; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold&quot;&gt;private static boolean &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold ; font-style: italic&quot;&gt;shouldParkAfterFailedAcquire&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold&quot;&gt;pred&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal&quot;&gt;) {&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre style=&quot;font-style: normal ; font-weight: 400 ; letter-spacing: normal ; text-align: left ; text-indent: 0px ; text-transform: none ; word-spacing: 0px ; font-family: &amp;quot;pt mono&amp;quot; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;pred&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;waitStatus&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;&lt;span&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;SIGNAL)&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * This node has already set status asking a release&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * to signal it, so it can safely park.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;&lt;span&gt;&amp;gt; &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * Predecessor was cancelled. Skip over predecessors and&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * indicate retry.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;do &lt;/span&gt;&lt;span&gt;{&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;prev &lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;pred &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;pred&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;prev&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;} &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;while &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;pred&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;waitStatus &lt;span&gt;&amp;gt; &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;pred&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;next &lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;} &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;else &lt;/span&gt;&lt;span&gt;{&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * waitStatus must be 0 or PROPAGATE.  Indicate that we&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * need a signal, but don&#39;t park yet.  Caller will need to&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         * retry to make sure it cannot acquire before parking.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;         */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span&gt;compareAndSetWaitStatus&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;pred&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;SIGNAL)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return false&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontSize=16;align=left;arcSize=7;" vertex="1" parent="1">
          <mxGeometry x="26" y="2220" width="776" height="664" as="geometry" />
        </mxCell>
        <mxCell id="zHQmcre7dR3sZDUqDH8s-2" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-size: 12px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;阻塞当前线程,直到被其他线程唤醒或者被中断，该函数才返回；&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;park（）函数返回有两种情况。&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;情况1：其他线程调用了unpark（Thread t）。&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;情况2：其他线程调用了t.interrupt（）。这里要注意的是，lock（）不能响应中断，&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;但LockSupport.park（）会响应中断。&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot; color=&quot;#ea6b66&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;也正因为LockSupport.park（）可能被中断唤醒，acquireQueued（..）&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot; color=&quot;#ea6b66&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;函数才写了一个for死循环；&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot; color=&quot;#ea6b66&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;唤醒之后，如果发现自己排在队列头部，就去拿锁；如果拿不到锁，则再次自己阻塞自己；&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot; color=&quot;#ea6b66&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;不断重复此过程，直到拿到锁。被唤醒之后，通过Thread.interrupted（）&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot; color=&quot;#ea6b66&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;来判断是否被中断唤醒；&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot; color=&quot;#ea6b66&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;如果是情况1，会返回false；&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot; color=&quot;#ea6b66&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;如果是情况2，则返回true；&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 12px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;parkAndCheckInterrupt&lt;/span&gt;() {&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-size: 12px&quot;&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;LockSupport&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;park&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;interrupted&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontSize=16;fontColor=#000000;align=left;arcSize=8;" vertex="1" parent="1">
          <mxGeometry x="827" y="2228" width="690" height="619" as="geometry" />
        </mxCell>
        <mxCell id="fj6ui93SYAHTBFZENV5a-1" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;公平锁与非公平锁tryAcquire()的&lt;/span&gt;实现唯一的区别是，&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;公平锁多了了一个!hasQueuedPredecessors()判断,&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;hasQueuedPredecessors()&lt;/span&gt;表示排队队列不为空，&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;并且排在队头的节点不是当前线程&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;!hasQueuedPredecessors()表示排队队列为空，&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;或者排在队头的节点是当前线程&lt;/pre&gt;" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.roundRectCallout;dx=15;dy=25;size=5;boundedLbl=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=14;align=left;fontColor=#FF8000;" vertex="1" parent="1">
          <mxGeometry x="1754" y="346" width="361" height="222" as="geometry" />
        </mxCell>
        <mxCell id="fj6ui93SYAHTBFZENV5a-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=16;fontColor=#000000;" edge="1" parent="1" source="fj6ui93SYAHTBFZENV5a-2" target="fj6ui93SYAHTBFZENV5a-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="fj6ui93SYAHTBFZENV5a-2" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;private &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;addWaiter&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;mode&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;) {&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;node &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;currentThread&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;mode&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 16px&quot;&gt;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 16px&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;pred &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;= &lt;/span&gt;tail&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;pred &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;) {&lt;font color=&quot;#ea6b66&quot;&gt;//尾指针不为空,当前node进行&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#ea6b66&quot;&gt;CAS入队&lt;br&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;&lt;span&gt;	&lt;/span&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;.&lt;/span&gt;prev &lt;span style=&quot;font-size: 16px&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;pred&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;compareAndSetTail&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;pred&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;)) {&lt;font color=&quot;#ea6b66&quot;&gt;//入队成功，返回node节点&lt;/font&gt;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;pred&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;.&lt;/span&gt;next &lt;span style=&quot;font-size: 16px&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;}&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;    }&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;  &lt;font color=&quot;#000099&quot;&gt; &lt;/font&gt;&lt;b&gt;&lt;font color=&quot;#cc0000&quot;&gt; &lt;/font&gt;&lt;/b&gt;&lt;/span&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;enq&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;)&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;&lt;b&gt;&lt;font color=&quot;#cc0000&quot;&gt;;&lt;/font&gt;&lt;/b&gt;&lt;font color=&quot;#ea6b66&quot;&gt;//&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#ea6b66&quot;&gt;尾指针为空,入队&lt;/font&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=16;align=left;arcSize=9;" vertex="1" parent="1">
          <mxGeometry x="1571.5" y="1473" width="637" height="362" as="geometry" />
        </mxCell>
        <mxCell id="fj6ui93SYAHTBFZENV5a-3" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;private &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;enq&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;) {&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;) {&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;t &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;= &lt;/span&gt;tail&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;t &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;) {&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 16px&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;//&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#ea6b66&quot;&gt;第一次循环，初始化队列链表&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-style: italic ; font-size: 16px&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;compareAndSetHead&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;()))&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;                &lt;/span&gt;tail &lt;span style=&quot;font-size: 16px&quot;&gt;= &lt;/span&gt;head&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;{&lt;font color=&quot;#ea6b66&quot;&gt;//入队&lt;/font&gt;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 16px&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;.&lt;/span&gt;prev &lt;span style=&quot;font-size: 16px&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 16px&quot;&gt;t&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt; &lt;font color=&quot;#ea6b66&quot;&gt;           对&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#ea6b66&quot;&gt;tail进行CAS操作指向当前节点，如果入队成功，退出循环，&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;            返回node的前置节点，入队失败，不断循环，直到入队成功为止&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 16px ; font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;compareAndSetTail&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 16px ; font-weight: bold&quot;&gt;t&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 16px ; font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;)) {&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-size: 16px ; font-weight: bold&quot;&gt;t&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;.next &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 16px ; font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-size: 16px ; font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 16px ; font-weight: bold&quot;&gt;t&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;;&lt;font color=&quot;#ea6b66&quot;&gt;//入队成功，退出循环，返回node的前置节点&lt;/font&gt;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;}&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;        }&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;    }&lt;br style=&quot;font-size: 16px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 16px&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=16;align=left;arcSize=7;" vertex="1" parent="1">
          <mxGeometry x="1594.5" y="1916" width="591" height="478" as="geometry" />
        </mxCell>
        <mxCell id="LJiyFS2h39R52KiVN35J-1" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;&amp;lt;&amp;lt;Interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br&gt;&lt;b&gt;ReentrantLock&lt;/b&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+&amp;nbsp;&amp;nbsp;sync: Sync extends AQS&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lockInterruptibly() throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock(long time, TimeUnit unit) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;span style=&quot;font-size: x-small&quot;&gt;+ void unlock();&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;rounded=0;glass=0;labelBackgroundColor=#ffffff;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;" vertex="1" parent="1">
          <mxGeometry x="141" y="182" width="450" height="170" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="m-LhpGy6pDTVkrjs-Amt" name="读写锁">
    <mxGraphModel dx="2514" dy="1325" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="3000" pageHeight="1000" math="0" shadow="0">
      <root>
        <mxCell id="4Kn29drxNQvWNtrvnITc-0" />
        <mxCell id="4Kn29drxNQvWNtrvnITc-1" parent="4Kn29drxNQvWNtrvnITc-0" />
        <mxCell id="4Kn29drxNQvWNtrvnITc-2" value="读写锁实现" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;glass=0;labelBackgroundColor=none;fontSize=30;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="2948" y="23" width="190" height="40" as="geometry" />
        </mxCell>
        <mxCell id="VO5wA90HG24xElYhcVth-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.998;entryY=0.541;entryDx=0;entryDy=0;entryPerimeter=0;" parent="4Kn29drxNQvWNtrvnITc-1" source="C6gt7NBxkSrmRmRFl4JR-8" target="C6gt7NBxkSrmRmRFl4JR-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VO5wA90HG24xElYhcVth-10" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="4Kn29drxNQvWNtrvnITc-1" source="C6gt7NBxkSrmRmRFl4JR-8" target="C6gt7NBxkSrmRmRFl4JR-14" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C6gt7NBxkSrmRmRFl4JR-8" value="共用&lt;br&gt;Sync" style="html=1;whiteSpace=wrap;aspect=fixed;shape=isoRectangle;rounded=0;glass=0;labelBackgroundColor=#ffffff;fontSize=16;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;align=center;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="1891" y="626.5" width="115.01" height="69" as="geometry" />
        </mxCell>
        <mxCell id="2I2go7Ke-rsbTxs8lcRy-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="C6gt7NBxkSrmRmRFl4JR-12" target="Z4jG9dqAK4cvpMTp8F6e-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C6gt7NBxkSrmRmRFl4JR-12" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;&quot;&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;sync&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;acquireShared&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="shape=ext;double=1;rounded=1;whiteSpace=wrap;html=1;glass=0;labelBackgroundColor=#ffffff;fontSize=16;strokeColor=#000000;fillColor=#ffffff;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="1297.5" y="839" width="303" height="124" as="geometry" />
        </mxCell>
        <mxCell id="2I2go7Ke-rsbTxs8lcRy-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="C6gt7NBxkSrmRmRFl4JR-13" target="C6gt7NBxkSrmRmRFl4JR-12" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C6gt7NBxkSrmRmRFl4JR-13" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;&amp;lt;&amp;lt;Class&amp;gt;&amp;gt;&lt;/i&gt;&lt;br&gt;&lt;b&gt;ReadLock&lt;/b&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+&amp;nbsp;&amp;nbsp;sync: Sync extends AQS&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lockInterruptibly() throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock(long time, TimeUnit unit) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;span style=&quot;font-size: x-small&quot;&gt;+ void unlock();&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;rounded=0;glass=0;labelBackgroundColor=#ffffff;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="1224.5" y="569" width="450" height="170" as="geometry" />
        </mxCell>
        <mxCell id="iOsgHEEnQ7MRM6_jHvUU-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=16;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="C6gt7NBxkSrmRmRFl4JR-14" target="2I2go7Ke-rsbTxs8lcRy-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="C6gt7NBxkSrmRmRFl4JR-14" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;&amp;lt;&amp;lt;&lt;/i&gt;&lt;i&gt;Class&lt;/i&gt;&lt;i&gt;&amp;gt;&amp;gt;&lt;/i&gt;&lt;br&gt;&lt;b&gt;WriteLock&lt;/b&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+&amp;nbsp;&amp;nbsp;sync: Sync extends AQS&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lockInterruptibly() throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock(long time, TimeUnit unit) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;span style=&quot;font-size: x-small&quot;&gt;+ void unlock();&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;rounded=0;glass=0;labelBackgroundColor=#ffffff;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="2336" y="576" width="450" height="170" as="geometry" />
        </mxCell>
        <mxCell id="VO5wA90HG24xElYhcVth-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;" parent="4Kn29drxNQvWNtrvnITc-1" source="lFT8Ks_veNPhik5HumSQ-1" target="C6gt7NBxkSrmRmRFl4JR-13" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2095" y="443" />
              <mxPoint x="1450" y="443" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="VO5wA90HG24xElYhcVth-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.531;entryY=-0.024;entryDx=0;entryDy=0;entryPerimeter=0;exitX=0.5;exitY=1;exitDx=0;exitDy=0;" parent="4Kn29drxNQvWNtrvnITc-1" source="lFT8Ks_veNPhik5HumSQ-1" target="C6gt7NBxkSrmRmRFl4JR-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2095" y="445" />
              <mxPoint x="2575" y="445" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="lFT8Ks_veNPhik5HumSQ-1" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;&amp;lt;&amp;lt;Interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br&gt;&lt;b&gt;Lock&lt;/b&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+&amp;nbsp;&amp;nbsp;sync: Sync extends AQS&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lockInterruptibly() throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock(long time, TimeUnit unit) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;span style=&quot;font-size: x-small&quot;&gt;+ void unlock();&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;rounded=0;glass=0;labelBackgroundColor=#ffffff;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="1870" y="105" width="450" height="170" as="geometry" />
        </mxCell>
        <mxCell id="IV8Pi7yk3Z52DkysMaKs-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.465;entryY=-0.002;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Helvetica;fontSize=14;fontColor=#FF8000;" edge="1" parent="4Kn29drxNQvWNtrvnITc-1" source="VO5wA90HG24xElYhcVth-0" target="iOsgHEEnQ7MRM6_jHvUU-5">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VO5wA90HG24xElYhcVth-0" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;i&gt;&amp;lt;&amp;lt;Class&amp;gt;&amp;gt;&lt;/i&gt;&lt;br&gt;&lt;b&gt;ReentrantReadWriteLock&lt;/b&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;+ readerLock: ReadLock&amp;nbsp;implement Lock&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;+ writerLock: WriteLock implement Lock&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;+ readLock(): ReadLock&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;+ writeLock(): WriteLock&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;rounded=0;glass=0;labelBackgroundColor=#ffffff;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="3433.5" y="275" width="408" height="160" as="geometry" />
        </mxCell>
        <mxCell id="Z4jG9dqAK4cvpMTp8F6e-5" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static final class &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;FairSync &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;extends &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Sync &lt;/span&gt;&lt;span&gt;{&lt;/span&gt;&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;writerShouldBlock&lt;/span&gt;&lt;span&gt;() {//写线程是否应该阻塞&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span&gt;hasQueuedPredecessors&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;//如果排队队列不为空，&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;&lt;span&gt; &lt;/span&gt;并且排在队头的节点线程不是当前准备抢锁的写线程，那么需要阻塞&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;readerShouldBlock&lt;/span&gt;&lt;span&gt;() {&lt;/span&gt;//读线程是否应该阻塞&lt;span&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span&gt;hasQueuedPredecessors&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;//如果排队队列不为空，&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt; 并且排在队头的节点线程不是当前准备抢锁的读线程，那么需要阻塞&lt;/pre&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="3613" y="1367" width="621" height="401" as="geometry" />
        </mxCell>
        <mxCell id="2I2go7Ke-rsbTxs8lcRy-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="Z4jG9dqAK4cvpMTp8F6e-6" target="Z4jG9dqAK4cvpMTp8F6e-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="iOsgHEEnQ7MRM6_jHvUU-1" value="&lt;pre style=&quot;color: rgb(0 , 0 , 0) ; text-align: left ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;tryAcquireShared()&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontColor=#FF0000;" parent="2I2go7Ke-rsbTxs8lcRy-3" vertex="1" connectable="0">
          <mxGeometry x="-0.2825" y="1" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="2I2go7Ke-rsbTxs8lcRy-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=14;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="Z4jG9dqAK4cvpMTp8F6e-6" target="2I2go7Ke-rsbTxs8lcRy-1" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="1461.5" y="1349" />
              <mxPoint x="1880.5" y="1349" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="iOsgHEEnQ7MRM6_jHvUU-2" value="&lt;pre style=&quot;color: rgb(0 , 0 , 0) ; text-align: left ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;doAcquireShared()&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontColor=#FF0000;" parent="2I2go7Ke-rsbTxs8lcRy-4" vertex="1" connectable="0">
          <mxGeometry x="0.5116" y="-3" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Z4jG9dqAK4cvpMTp8F6e-6" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;共享锁,模板方法&lt;/font&gt;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;Semaphore，CountDownLatch,ReentrantReadWriteLock&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;均有实现&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;public final void &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquireShared&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;tryAcquireShared&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;&lt;span&gt;) &lt;/span&gt;&lt;span&gt;&amp;lt; &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;)&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;doAcquireShared&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="1203.5" y="1018" width="516" height="260" as="geometry" />
        </mxCell>
        <mxCell id="VkflFZi93BrO_o7EnHx4-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="Z4jG9dqAK4cvpMTp8F6e-7" target="VkflFZi93BrO_o7EnHx4-0" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Z4jG9dqAK4cvpMTp8F6e-7" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;protected final int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;tryAcquireShared&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;unused&lt;/span&gt;) {&lt;br&gt;&lt;font color=&quot;#ea6b66&quot;&gt;    &lt;span style=&quot;font-style: italic&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * Walkthrough:&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * 1. 写线程持有锁，无法获取，直接退出.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * 2. Otherwise, this thread is eligible for&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    lock wrt state, so ask if it should block&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    because of queue policy. If not, try&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    to grant by CASing state and updating count.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    Note that step does not check for reentrant&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    acquires, which is postponed to full version&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    to avoid having to check hold count in&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    the more typical non-reentrant case.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * 3. If step 2 fails either because thread&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    apparently not eligible or CAS fails or count&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    saturated, chain to version with full retry loop.&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-style: italic&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;     */&lt;/font&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;.currentThread();&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;= getState();&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(exclusiveCount(&lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;) != 0 &amp;amp;&amp;amp;&lt;br&gt;        getExclusiveOwnerThread() != &lt;span style=&quot;font-weight: bold&quot;&gt;current&lt;/span&gt;)&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;        //写线程持有锁，并且当前线程不是自己(写线程也可以获取读锁),直接退出。&lt;/font&gt;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;-1;&lt;font color=&quot;#ea6b66&quot;&gt;//拿锁失败,返回-1&lt;/font&gt;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;r &lt;/span&gt;= sharedCount(&lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;);//读锁重入次数&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;font color=&quot;#cc0000&quot;&gt;!&lt;span style=&quot;font-weight: bold&quot;&gt;readerShouldBlock&lt;/span&gt;()&lt;/font&gt; &amp;amp;&amp;amp;&lt;font color=&quot;#ea6b66&quot;&gt;//公平与非公平实现的差异在这里&lt;/font&gt;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;r &lt;/span&gt;&amp;lt; MAX_COUNT &amp;amp;&amp;amp;&lt;br&gt;        compareAndSetState(&lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;+ SHARED_UNIT)) {&lt;font color=&quot;#ea6b66&quot;&gt;//CAS拿读锁，高16位加1&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;r &lt;/span&gt;== 0) {&lt;font color=&quot;#ea6b66&quot;&gt;//r在CAS之前等于0表示，当前是第一个获取读锁的线程&lt;/font&gt;&lt;br&gt;            firstReader = &lt;span style=&quot;font-weight: bold&quot;&gt;current&lt;/span&gt;;&lt;br&gt;            firstReaderHoldCount = 1;&lt;br&gt;        } &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(firstReader == &lt;span style=&quot;font-weight: bold&quot;&gt;current&lt;/span&gt;) {&lt;font color=&quot;#ea6b66&quot;&gt;//不是第一个获取读锁的线程&lt;/font&gt;&lt;br&gt;            firstReaderHoldCount++;&lt;br&gt;        } &lt;span style=&quot;font-weight: bold&quot;&gt;else &lt;/span&gt;{&lt;font color=&quot;#ea6b66&quot;&gt;//下面这一坨没什么鸟用&lt;/font&gt;&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;HoldCounter &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;= cachedHoldCounter;&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;== &lt;span style=&quot;font-weight: bold&quot;&gt;null &lt;/span&gt;|| &lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;.tid != getThreadId(&lt;span style=&quot;font-weight: bold&quot;&gt;current&lt;/span&gt;))&lt;br&gt;                cachedHoldCounter = &lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;= readHolds.get();&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;.count == 0)&lt;br&gt;                readHolds.set(&lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;);&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;.count++;&lt;br&gt;        }&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;1;&lt;font color=&quot;#ea6b66&quot;&gt;//拿锁成功,返回1&lt;/font&gt;&lt;br&gt;    }&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;fullTryAcquireShared(&lt;span style=&quot;font-weight: bold&quot;&gt;current&lt;/span&gt;);&lt;font color=&quot;#cc0000&quot;&gt;//上面拿锁失败，进入这个方法&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;不断自旋拿读锁&lt;/font&gt;&lt;br&gt;}&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;align=left;arcSize=3;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="779.5" y="1420" width="720" height="990" as="geometry" />
        </mxCell>
        <mxCell id="igNTjFW0UVVBTKPHFI3V-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;" edge="1" parent="4Kn29drxNQvWNtrvnITc-1" source="TUMVNPgcMENQiV9ykWhL-6">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3265.3" y="1674" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="TUMVNPgcMENQiV9ykWhL-6" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static final class &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;NonfairSync &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;extends &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Sync &lt;/span&gt;{&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;writerShouldBlock&lt;/span&gt;() {&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;return false&lt;/span&gt;;&lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;}&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;readerShouldBlock&lt;/span&gt;() {&lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;apparentlyFirstQueuedIsExclusive();&lt;br&gt;    }&lt;br&gt;}&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="3002.75" y="1365" width="525" height="232" as="geometry" />
        </mxCell>
        <mxCell id="2I2go7Ke-rsbTxs8lcRy-1" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;doAcquireShared&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;arg&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;addWaiter&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;SHARED)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;try &lt;/span&gt;&lt;span style=&quot;&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interrupted &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;predecessor&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;head&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;r &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;tryAcquireShared&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;arg&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;r &lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;gt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;setHeadAndPropagate&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;r&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;next &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;// help GC&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interrupted&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;selfInterrupt&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            }&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;shouldParkAfterFailedAcquire&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;amp;&amp;amp;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;&quot;&gt;parkAndCheckInterrupt&lt;/span&gt;&lt;span style=&quot;&quot;&gt;())&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interrupted &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    } &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;finally &lt;/span&gt;&lt;span style=&quot;&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;&quot;&gt;cancelAcquire&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=14;align=left;arcSize=6;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="1575.5" y="1423" width="609" height="632" as="geometry" />
        </mxCell>
        <mxCell id="KTipewaxF2whKSaPG7UM-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="2I2go7Ke-rsbTxs8lcRy-5" target="2I2go7Ke-rsbTxs8lcRy-6" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2I2go7Ke-rsbTxs8lcRy-5" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;lock&lt;/span&gt;&lt;span&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;sync&lt;span&gt;.&lt;/span&gt;&lt;span&gt;acquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;1&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;//走互斥锁流程&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=14;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="2383.5" y="842" width="355" height="107" as="geometry" />
        </mxCell>
        <mxCell id="rJTA5NB_A3fbP47ulosW-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=14;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="2I2go7Ke-rsbTxs8lcRy-6" target="rJTA5NB_A3fbP47ulosW-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="2I2go7Ke-rsbTxs8lcRy-6" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;写锁是互斥锁，和互斥锁的流程一样，都是基于AQS的模板方法，&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;&lt;b&gt;区别在tryAcquire()&lt;/b&gt;&lt;b style=&quot;font-size: 12.8pt ; white-space: normal&quot;&gt;方法的实现上&lt;/b&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;public final void &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;&lt;span&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;!&lt;/span&gt;&lt;span&gt;tryAcquire&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;&lt;span&gt;) &lt;/span&gt;&lt;span&gt;&amp;amp;&amp;amp;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;acquireQueued&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;addWaiter&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;EXCLUSIVE)&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;arg&lt;/span&gt;&lt;span&gt;))&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;selfInterrupt&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=14;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="2265.5" y="1055" width="591" height="251" as="geometry" />
        </mxCell>
        <mxCell id="rJTA5NB_A3fbP47ulosW-1" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;tryAcquire&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;font-style: italic&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * Walkthrough:&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * 1. If read count nonzero or write count nonzero&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    and owner is a different thread, fail.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * 2. If count would saturate, fail. (This can only&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    happen if count is already nonzero.)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     * 3. Otherwise, this thread is eligible for lock if&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    it is either a reentrant acquire or&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    queue policy allows it. If so, update state&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     *    and set owner.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;current &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;.currentThread();&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;= getState();&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;w &lt;/span&gt;= exclusiveCount(&lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;);//表示&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;!= 0) {//有线程持有锁（读锁或者写锁）&lt;br&gt;        &lt;span style=&quot;font-style: italic&quot;&gt;// (Note: if c != 0 and w == 0 then shared count != 0)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;w &lt;/span&gt;== 0 || &lt;span style=&quot;font-weight: bold&quot;&gt;current &lt;/span&gt;!= getExclusiveOwnerThread())&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;white-space: pre&quot;&gt; &lt;/span&gt;//w=0表示读线程占有锁，w!=0表示写线程占有锁，如果是写线程占有锁，&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;得看看是不是当前线程&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;return false&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;w &lt;/span&gt;+ exclusiveCount(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;) &amp;gt; MAX_COUNT)&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;throw new &lt;/span&gt;Error(&quot;Maximum lock count exceeded&quot;);&lt;br&gt;        &lt;span style=&quot;font-style: italic&quot;&gt;// Reentrant acquire&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;        &lt;/span&gt;setState(&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;+ &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;);&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;;&lt;br&gt;    }&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;//能走到这里，表示c=0,没有线程持有锁&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;font color=&quot;#ff0000&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;writerShouldBlock&lt;/span&gt;()&lt;/font&gt; ||&lt;br&gt;        !compareAndSetState(&lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;+ &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquires&lt;/span&gt;))&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;return false&lt;/span&gt;;&lt;br&gt;    setExclusiveOwnerThread(&lt;span style=&quot;font-weight: bold&quot;&gt;current&lt;/span&gt;);&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;;&lt;br&gt;}&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=14;align=left;arcSize=8;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="2219" y="1421" width="684" height="893" as="geometry" />
        </mxCell>
        <mxCell id="LARzN_jPg7y_6yzF4rrd-0" value="&lt;span style=&quot;font-size: 16px;&quot;&gt;读写锁和互斥锁的内部都定义了一个Sync内部类，继承AQS&lt;/span&gt;" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.cloud_callout;labelBackgroundColor=#ffffff;fontSize=16;align=left;fontColor=#FF3333;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="1954.5" y="504.5" width="230" height="122" as="geometry" />
        </mxCell>
        <mxCell id="LARzN_jPg7y_6yzF4rrd-2" value="&lt;font style=&quot;font-size: 16px&quot;&gt;注意：&lt;br&gt;互斥锁的tryAcquire()分公平和非公平实现，读写锁的tryAcquire()不区分&lt;/font&gt;" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.cloud_callout;labelBackgroundColor=#ffffff;fontSize=14;align=left;fontColor=#FF3333;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="2856.5" y="922.5" width="305" height="161" as="geometry" />
        </mxCell>
        <mxCell id="iOsgHEEnQ7MRM6_jHvUU-0" value="注意：&lt;br&gt;读写锁的&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot; ; font-size: 12.8pt&quot;&gt;tryAcquireShared()方法&lt;br&gt;不区分公平和非公平实现&lt;/span&gt;" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.cloud_callout;labelBackgroundColor=#ffffff;fontSize=16;align=left;fontColor=#FF0000;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="1709.5" y="859" width="384" height="168" as="geometry" />
        </mxCell>
        <mxCell id="iOsgHEEnQ7MRM6_jHvUU-4" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;ReadLock和WriteLock共用一个Sync对象，ReentrantReadWriteLock内部&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;维护一个Sync对象，ReentrantLock内部也维护一个Sync对象，均继承AQS&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ReentrantReadWriteLock&lt;/span&gt;(&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;fair&lt;/span&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;    sync = &lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;fair &lt;/span&gt;? &lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;new &lt;/span&gt;FairSync() : &lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;new &lt;/span&gt;NonfairSync();&lt;br style=&quot;font-size: 14px;&quot;&gt;    readerLock = &lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;new &lt;/span&gt;ReadLock(&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;this&lt;/span&gt;);&lt;br style=&quot;font-size: 14px;&quot;&gt;    writerLock = &lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;new &lt;/span&gt;WriteLock(&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;this&lt;/span&gt;);&lt;br style=&quot;font-size: 14px;&quot;&gt;}&lt;/pre&gt;" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.rectCallout;dx=30;dy=15;boundedLbl=1;labelBackgroundColor=#ffffff;fontSize=14;align=left;fontColor=#FF6666;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="2330" y="104" width="512" height="195" as="geometry" />
        </mxCell>
        <mxCell id="iOsgHEEnQ7MRM6_jHvUU-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;exitX=0.465;exitY=1;exitDx=0;exitDy=0;exitPerimeter=0;" parent="4Kn29drxNQvWNtrvnITc-1" source="iOsgHEEnQ7MRM6_jHvUU-5" target="TUMVNPgcMENQiV9ykWhL-6" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3628" y="1122" />
              <mxPoint x="3628" y="1318" />
              <mxPoint x="3266" y="1318" />
            </Array>
            <mxPoint x="3627.75" y="1269" as="sourcePoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iOsgHEEnQ7MRM6_jHvUU-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="iOsgHEEnQ7MRM6_jHvUU-5" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3629" y="1318" />
              <mxPoint x="3903" y="1318" />
            </Array>
            <mxPoint x="3628.75" y="1269" as="sourcePoint" />
            <mxPoint x="3902.8" y="1368" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="iOsgHEEnQ7MRM6_jHvUU-5" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;&lt;br class=&quot;Apple-interchange-newline&quot;&gt;abstract static class &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Sync &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;extends &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;AbstractQueuedSynchronizer &lt;/span&gt;{&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;private static final long &lt;/span&gt;serialVersionUID = 6317671515068378041L;&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;font-style: italic&quot;&gt;/*&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;     *同互斥锁一样，读写锁也是用state变量来表示锁状态的。&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;     *只是state变量在这里的含义和互斥锁完全不同。&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;     *同互斥锁一样，读写锁也是用state变量来表示锁状态的。只是state变量在这里的含义和互斥锁完全不同。&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;     *在内部类Sync中，对state变量进行了重新定义，分高16位和低16位（一个int类型4个字节）,&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;     *高16位表示读锁重入次数，低16位表示写锁重入次数&lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;     */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static final int &lt;/span&gt;SHARED_SHIFT   = 16;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;static final int &lt;/span&gt;SHARED_UNIT    = (1 &amp;lt;&amp;lt; SHARED_SHIFT);&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;static final int &lt;/span&gt;MAX_COUNT      = (1 &amp;lt;&amp;lt; SHARED_SHIFT) - 1;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;static final int &lt;/span&gt;EXCLUSIVE_MASK = (1 &amp;lt;&amp;lt; SHARED_SHIFT) - 1;&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;font-style: italic&quot;&gt;/** Returns the number of shared holds represented in count  */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;sharedCount&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;c&lt;/span&gt;)    { &lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;c &lt;/span&gt;&amp;gt;&amp;gt;&amp;gt; SHARED_SHIFT; }&lt;br&gt;    &lt;span style=&quot;font-style: italic&quot;&gt;/** Returns the number of exclusive holds represented in count  */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;static int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;exclusiveCount&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;c&lt;/span&gt;) { &lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;c &lt;/span&gt;&amp;amp; EXCLUSIVE_MASK; }&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=16;fontColor=#000000;align=left;arcSize=10;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="3224" y="504.5" width="890" height="617" as="geometry" />
        </mxCell>
        <mxCell id="VkflFZi93BrO_o7EnHx4-0" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;final int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;fullTryAcquireShared&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * This code is in part redundant with that in&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * tryAcquireShared but is simpler overall by not&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * complicating tryAcquireShared with interactions between&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * retries and lazily reading hold counts.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;HoldCounter &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;getState&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;exclusiveCount&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;getExclusiveOwnerThread&lt;/span&gt;&lt;span style=&quot;&quot;&gt;() &lt;/span&gt;&lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;// else we hold the exclusive lock; blocking here&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;            // would cause deadlock.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;readerShouldBlock&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;// Make sure we&#39;re not acquiring read lock reentrantly&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;firstReader &lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;// assert firstReaderHoldCount &amp;gt; 0;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;cachedHoldCounter&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;tid &lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;getThreadId&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;readHolds&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;get&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;count &lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                            &lt;/span&gt;readHolds&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;remove&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                }&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;count &lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;&quot;&gt;-&lt;/span&gt;&lt;span style=&quot;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        }&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;sharedCount&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;&quot;&gt;MAX_COUNT)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;&quot;&gt;Error&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&quot;Maximum lock count exceeded&quot;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;compareAndSetState&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;&quot;&gt;+ &lt;/span&gt;&lt;span style=&quot;&quot;&gt;SHARED_UNIT)) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;sharedCount&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;firstReader &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;firstReaderHoldCount &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;firstReader &lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;firstReaderHoldCount&lt;span style=&quot;&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;cachedHoldCounter&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;tid &lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;getThreadId&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;&quot;&gt;))&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;readHolds&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;get&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;count &lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;readHolds&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;set&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;count&lt;span style=&quot;&quot;&gt;++&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;cachedHoldCounter &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;// cache for release&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    }&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=16;align=left;arcSize=4;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="772" y="2501" width="735" height="1170" as="geometry" />
        </mxCell>
        <mxCell id="VkflFZi93BrO_o7EnHx4-2" value="&lt;pre style=&quot;text-align: left ; font-family: &amp;quot;pt mono&amp;quot; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;不断自旋拿读锁&lt;/font&gt;&lt;/pre&gt;" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;fontSize=16;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="1132.5" y="2434" width="133" height="33" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-0" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="pSSy6d7iewiJqJxX9ky8-1" target="pSSy6d7iewiJqJxX9ky8-5" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-1" value="释放读锁" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;fontSize=30;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="5934.5" y="166" width="137" height="31" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="pSSy6d7iewiJqJxX9ky8-3" target="pSSy6d7iewiJqJxX9ky8-7" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-3" value="释放写锁" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=none;fontSize=30;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="7492.75" y="166" width="131.5" height="21" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.48;entryY=-0.005;entryDx=0;entryDy=0;entryPerimeter=0;fontSize=18;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="pSSy6d7iewiJqJxX9ky8-5" target="pSSy6d7iewiJqJxX9ky8-20" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-5" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;unlock&lt;/span&gt;&lt;span style=&quot;&quot;&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;sync&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;releaseShared&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=16;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="5863" y="266" width="280" height="119" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="pSSy6d7iewiJqJxX9ky8-7" target="pSSy6d7iewiJqJxX9ky8-13" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-7" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;unlock&lt;/span&gt;&lt;span style=&quot;&quot;&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;sync&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;release&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=16;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="7440" y="266" width="237" height="112" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-8" value="写锁是互斥锁，&lt;br&gt;流程和互斥锁一样" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.cloud_callout;labelBackgroundColor=none;fontSize=16;fontColor=#000000;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="7677" y="166" width="162" height="120" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#000000;entryX=0.588;entryY=0.007;entryDx=0;entryDy=0;entryPerimeter=0;" parent="4Kn29drxNQvWNtrvnITc-1" source="pSSy6d7iewiJqJxX9ky8-13" target="pSSy6d7iewiJqJxX9ky8-14" edge="1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="6947" y="964" as="targetPoint" />
            <Array as="points">
              <mxPoint x="7559" y="852" />
              <mxPoint x="7184" y="852" />
              <mxPoint x="7184" y="988" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-10" value="&lt;pre style=&quot;text-align: left ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;tryRelease()&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontColor=#000000;" parent="pSSy6d7iewiJqJxX9ky8-9" vertex="1" connectable="0">
          <mxGeometry x="0.0206" y="2" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="pSSy6d7iewiJqJxX9ky8-13" target="pSSy6d7iewiJqJxX9ky8-15" edge="1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="7559" y="852" />
              <mxPoint x="7951" y="852" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-12" value="&lt;pre style=&quot;text-align: left ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;unparkSuccessor()&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontColor=#000000;" parent="pSSy6d7iewiJqJxX9ky8-11" vertex="1" connectable="0">
          <mxGeometry x="-0.0505" y="2" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-13" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;public final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;release&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;arg&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;tryRelease&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;arg&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;head&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;waitStatus &lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;&quot;&gt;unparkSuccessor&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return true&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return false&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="7274" y="489" width="569" height="285" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-14" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;tryRelease&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;releases&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;&quot;&gt;isHeldExclusively&lt;/span&gt;&lt;span style=&quot;&quot;&gt;())&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;&quot;&gt;IllegalMonitorStateException&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;getState&lt;/span&gt;&lt;span style=&quot;&quot;&gt;() &lt;/span&gt;&lt;span style=&quot;&quot;&gt;- &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;releases&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;free &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;exclusiveCount&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;free&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;setExclusiveOwnerThread&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;setState&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;nextc&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;free&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;arcSize=9;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="6856" y="986" width="538" height="280" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-15" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;unparkSuccessor&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * If status is negative (i.e., possibly needing signal) try&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * to clear in anticipation of signalling.  It is OK if this&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * fails or if status is changed by waiting thread.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;waitStatus&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;compareAndSetWaitStatus&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * Thread to unpark is held in successor, which is normally&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * just the next node.  But if cancelled or apparently null,&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * traverse backwards from tail to find the actual&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * non-cancelled successor.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;next&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;waitStatus &lt;span style=&quot;&quot;&gt;&amp;gt; &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;tail&lt;span style=&quot;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;&lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;&lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;prev&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;waitStatus &lt;span style=&quot;&quot;&gt;&amp;lt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;LockSupport&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;unpark&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;thread&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;arcSize=7;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="7504" y="986" width="666" height="610" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="pSSy6d7iewiJqJxX9ky8-20" target="pSSy6d7iewiJqJxX9ky8-21" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-17" value="&lt;pre style=&quot;text-align: left ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;tryReleaseShared()&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontColor=#000000;" parent="pSSy6d7iewiJqJxX9ky8-16" vertex="1" connectable="0">
          <mxGeometry x="-0.0354" y="2" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-18" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=18;fontColor=#000000;" parent="4Kn29drxNQvWNtrvnITc-1" source="pSSy6d7iewiJqJxX9ky8-20" target="pSSy6d7iewiJqJxX9ky8-22" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-19" value="&lt;pre style=&quot;text-align: left ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;doReleaseShared()&lt;/pre&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=18;fontColor=#000000;" parent="pSSy6d7iewiJqJxX9ky8-18" vertex="1" connectable="0">
          <mxGeometry x="0.0903" y="-1" relative="1" as="geometry">
            <mxPoint y="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-20" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;public final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;releaseShared&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;arg&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;tryReleaseShared&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;arg&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;doReleaseShared&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return true&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return false&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="5766" y="456" width="492" height="221" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-21" value="&lt;pre&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;protected final boolean &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold ; font-style: italic&quot;&gt;tryReleaseShared&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold ; font-style: italic&quot;&gt;unused&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;font color=&quot;#994c00&quot;&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;current &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;currentThread&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;firstReader &lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-style: italic&quot;&gt;// assert firstReaderHoldCount &amp;gt; 0;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;firstReaderHoldCount &lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;            &lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;firstReader &lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;else&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;            &lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;firstReaderHoldCount&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;--&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;HoldCounter &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;= &lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;cachedHoldCounter&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;.&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;tid &lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;getThreadId&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;current&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;))&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;rh &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;= &lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;readHolds&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;get&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;count &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;.&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;count&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;count &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&amp;lt;= &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;            &lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;readHolds&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;remove&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;count &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&amp;lt;= &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;throw &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;unmatchedUnlockException&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;--&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;rh&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;.&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;count&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#994c00&quot;&gt;}//这一段废代码不用看，不影响释放锁，主要看下面的for循环 + CAS&lt;/font&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;;&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;) {&lt;font color=&quot;#ff0000&quot;&gt;//&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;因为读锁是共享锁，多个线程会同时持有读锁，&lt;/font&gt;&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;所以对读锁的释放不能直接减1，而是需要通过一个for循环+CAS操作不断重试。&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;getState&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;nextc &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;- &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;SHARED_UNIT&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;compareAndSetState&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;nextc&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;))&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-style: italic&quot;&gt;// Releasing the read lock has no effect on readers,&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-style: italic&quot;&gt;            // but it may allow waiting writers to proceed if&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-style: italic&quot;&gt;            // both read and write locks are now free.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-style: italic&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;nextc &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;arcSize=8;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="5357" y="944" width="667" height="812" as="geometry" />
        </mxCell>
        <mxCell id="pSSy6d7iewiJqJxX9ky8-22" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;doReleaseShared&lt;/span&gt;&lt;span style=&quot;&quot;&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;/*&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * Ensure that a release propagates, even if there are other&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * in-progress acquires/releases.  This proceeds in the usual&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * way of trying to unparkSuccessor of head if it needs&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * signal. But if it does not, status is set to PROPAGATE to&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * ensure that upon release, propagation continues.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * Additionally, we must loop in case a new node is added&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * while we are doing this. Also, unlike other uses of&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * unparkSuccessor, we need to know if CAS to reset status&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     * fails, if so rechecking.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;     */&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;head&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;tail&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;waitStatus&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;SIGNAL) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;&quot;&gt;compareAndSetWaitStatus&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;SIGNAL&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;))&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;continue&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;            &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;// loop to recheck cases&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;&quot;&gt;unparkSuccessor&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0 &lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;amp;&amp;amp;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                     !&lt;/span&gt;&lt;span style=&quot;&quot;&gt;compareAndSetWaitStatus&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;PROPAGATE))&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;continue&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;                &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;// loop on failed CAS&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;head&lt;span style=&quot;&quot;&gt;)                   &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;// loop if head changed&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;arcSize=7;" parent="4Kn29drxNQvWNtrvnITc-1" vertex="1">
          <mxGeometry x="6081" y="944" width="713" height="702" as="geometry" />
        </mxCell>
        <mxCell id="igNTjFW0UVVBTKPHFI3V-1" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;b&gt;&lt;font color=&quot;#cc0000&quot;&gt;返回true的条件：&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;b&gt;&lt;font color=&quot;#cc0000&quot;&gt;（1）头节点不为空&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;b&gt;&lt;font color=&quot;#cc0000&quot;&gt;（2）头结点next指向的节点不为空&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;b&gt;&lt;font color=&quot;#cc0000&quot;&gt;（3）头结点next指向的节点的nextWaiter代表的节点不是一个SHARED节点&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;pre style=&quot;font-size: 12.8pt ; font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;b&gt;&lt;font color=&quot;#cc0000&quot;&gt;（4）头结点next指向的节点表示的线程不为空&lt;/font&gt;&lt;/b&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;apparentlyFirstQueuedIsExclusive&lt;/span&gt;&lt;span&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;head&lt;span&gt;) &lt;/span&gt;&lt;span&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;null &lt;/span&gt;&lt;span&gt;&amp;amp;&amp;amp;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;next&lt;span&gt;)  &lt;/span&gt;&lt;span&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;null &lt;/span&gt;&lt;span&gt;&amp;amp;&amp;amp;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        !&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;isShared&lt;/span&gt;&lt;span&gt;()         &lt;/span&gt;&lt;span&gt;&amp;amp;&amp;amp;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;thread &lt;span&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontSize=16;align=left;arcSize=11;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="2966" y="1677" width="598.5" height="424" as="geometry" />
        </mxCell>
        <mxCell id="igNTjFW0UVVBTKPHFI3V-3" value="&lt;span style=&quot;font-size: 14px;&quot;&gt;读锁：&lt;/span&gt;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;公平：&lt;/font&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;排在队头的节点线程是否是当前准备抢锁的读线程，是，不阻塞，&lt;/span&gt;&lt;span style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;不是，阻塞&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;font style=&quot;font-size: 14px;&quot;&gt;非公平：&lt;/font&gt;&lt;/span&gt;" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.roundRectCallout;dx=30;dy=15;size=5;boundedLbl=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontSize=14;align=left;fontColor=#FF8000;" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="1512.5" y="2136" width="491.5" height="170" as="geometry" />
        </mxCell>
        <mxCell id="bdlvbnlJ94b-HTQCLplF-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="4Kn29drxNQvWNtrvnITc-1" source="bdlvbnlJ94b-HTQCLplF-0" target="VO5wA90HG24xElYhcVth-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="bdlvbnlJ94b-HTQCLplF-0" value="&lt;p style=&quot;margin: 4px 0px 0px ; text-align: center ; font-size: 14px&quot;&gt;&lt;i style=&quot;font-size: 14px&quot;&gt;&amp;lt;&amp;lt;Interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;ReadWriteLock&lt;/b&gt;&lt;/span&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 14px&quot;&gt;&lt;div style=&quot;font-size: 14px&quot;&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;+ Lock &lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;readLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;+ Lock &lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;writeLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;/div&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=14;fontFamily=Helvetica;html=1;rounded=0;glass=0;labelBackgroundColor=#ffffff;strokeColor=#000000;fillColor=#ffffff;fontStyle=0" vertex="1" parent="4Kn29drxNQvWNtrvnITc-1">
          <mxGeometry x="3434" y="86" width="406" height="102" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="94OT3PsqGM0_eiHjXmH7" name="StampedLock">
    <mxGraphModel dx="1924" dy="1135" grid="0" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="5000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="Sfc9aITo4xTI0m3XfOoi-0" />
        <mxCell id="Sfc9aITo4xTI0m3XfOoi-1" parent="Sfc9aITo4xTI0m3XfOoi-0" />
        <mxCell id="Ej6mf5tEDbmiwn3buK7E-8" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=16;fontColor=#000000;" edge="1" parent="Sfc9aITo4xTI0m3XfOoi-1" source="Ej6mf5tEDbmiwn3buK7E-1" target="Ej6mf5tEDbmiwn3buK7E-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ej6mf5tEDbmiwn3buK7E-1" value="&lt;h1&gt;&lt;span style=&quot;font-weight: 400 ; text-align: center&quot;&gt;&lt;font style=&quot;font-size: 36px&quot;&gt;StamptedLock&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/h1&gt;&lt;p&gt;（1）StampedLock本质还是一种读写锁（注意：不是ReentrantLock，自己实现的一套读写锁），只是在读写的场景，不加锁，而是读之前给数据加一个版本，在用数据的时候先看看数据的版本变了没有，如果版本没有变，说明没有线程修改数据，直接用，如果版本变了，说明数据被修改了，废弃已读到的数据，开始走加锁流程；&lt;br&gt;（2）StampedLock和读写锁一样，把一个state变量分成两半，分别表示读锁和写锁的状态。同时，state还需要记录数据的version，但正如前面所说，一次CAS没有办法操作两个变量，所以这个state变量本身同时也表示了数据的version；&lt;br&gt;（3）StampedLock重新定义了一个阻塞队列（也是基于双向链表实现），&lt;u style=&quot;color: rgb(155 , 0 , 255) ; font-weight: bold&quot;&gt;基于这个阻塞队列实现的锁的调度策略和AQS很不一样，也就是“自旋”。在AQS里面，当一个线程CAS state失败之后，会立即加入阻塞队列，并且进入阻塞状态。但在StampedLock中，CAS state失败之后，会不断自旋，自旋足够多的次数之后，如果还拿不到锁，才进入阻塞状态。&lt;/u&gt;为此，根据CPU的核数，定义了自旋次数的常量值。如果是单核的CPU，肯定不能自旋，在多核情况下，才采用自旋策略；&lt;br&gt;&lt;/p&gt;" style="text;html=1;strokeColor=#d79b00;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=16;align=left;labelBorderColor=#FF6666;fillColor=#ffe6cc;sketch=1;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="2880" y="40" width="840" height="310" as="geometry" />
        </mxCell>
        <mxCell id="Ej6mf5tEDbmiwn3buK7E-12" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;exitX=1;exitY=0.5;exitDx=0;exitDy=0;fontFamily=Helvetica;fontSize=12;fontColor=#FF8000;" edge="1" parent="Sfc9aITo4xTI0m3XfOoi-1" source="Ej6mf5tEDbmiwn3buK7E-3">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3677" y="558" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7JDtL0tR_l5SlFASerlo-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1;entryY=0.5;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="Sfc9aITo4xTI0m3XfOoi-1" source="Ej6mf5tEDbmiwn3buK7E-3" target="VU9lz8AgeltI_XvXMwfi-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qHkZKfYIwSoKQyKUJhUR-1" value="WriteLock" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="7JDtL0tR_l5SlFASerlo-6">
          <mxGeometry x="0.6505" y="-1" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="7JDtL0tR_l5SlFASerlo-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.998;entryY=0.42;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="Sfc9aITo4xTI0m3XfOoi-1" source="Ej6mf5tEDbmiwn3buK7E-3" target="7JDtL0tR_l5SlFASerlo-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="qHkZKfYIwSoKQyKUJhUR-2" value="ReadWriteLock" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="7JDtL0tR_l5SlFASerlo-7">
          <mxGeometry x="0.7891" y="-2" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="qHkZKfYIwSoKQyKUJhUR-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.007;entryY=0.553;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="Sfc9aITo4xTI0m3XfOoi-1" source="Ej6mf5tEDbmiwn3buK7E-3" target="Ej6mf5tEDbmiwn3buK7E-9">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2863" y="558" />
              <mxPoint x="2863" y="393" />
              <mxPoint x="2632" y="393" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="qHkZKfYIwSoKQyKUJhUR-5" value="ReadLock" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=14;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="qHkZKfYIwSoKQyKUJhUR-4">
          <mxGeometry x="0.6095" y="-2" relative="1" as="geometry">
            <mxPoint x="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="Ej6mf5tEDbmiwn3buK7E-3" value="&lt;p style=&quot;margin: 4px 0px 0px ; text-align: center ; font-size: 16px&quot;&gt;&lt;i&gt;&amp;lt;&amp;lt;Class&amp;gt;&amp;gt;&lt;/i&gt;&lt;br&gt;&lt;span&gt;StamptedLock&lt;/span&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 12px&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 12px&quot;&gt;+ whead: WNode;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 12px&quot;&gt;//Head of CLH queue&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 12px&quot;&gt;+ wtail: WNode;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 12px&quot;&gt;//Tail (last) of CLH queue&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 12px&quot;&gt;// views&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 12px&quot;&gt;+&amp;nbsp; readLockView ReadLockView;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 12px&quot;&gt;+&amp;nbsp; writeLockView WriteLockView;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 12px&quot;&gt;+&amp;nbsp; readWriteLockView ReadWriteLockView;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 12px&quot;&gt;&lt;br style=&quot;font-size: 12px&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 12px&quot;&gt;+ state&amp;nbsp; long;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 12px&quot;&gt;//核心参数，volatile变量，读锁，写锁，版本&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 12px&quot;&gt;+ readerOverflow int;&lt;/p&gt;&lt;hr style=&quot;font-size: 12px&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 12px&quot;&gt;+ tryOptimisticRead(): long&lt;br style=&quot;font-size: 12px&quot;&gt;+ validate(long): boolean&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontStyle=0;fillColor=#ffe6cc;strokeColor=#d79b00;rounded=0;sketch=1;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="3090" y="434" width="419" height="247" as="geometry" />
        </mxCell>
        <mxCell id="Ej6mf5tEDbmiwn3buK7E-4" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;pre style=&quot;text-align: center ; font-size: 14px ; color: rgb(255 , 128 , 0) ; font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;public long &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 14px&quot;&gt;readLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;() {&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;= &lt;/span&gt;state&lt;span style=&quot;font-size: 14px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;next&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;((&lt;/span&gt;whead &lt;span style=&quot;font-size: 14px&quot;&gt;== &lt;/span&gt;wtail &lt;span style=&quot;font-size: 14px&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;ABITS) &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;RFULL &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;             &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;compareAndSwapLong&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;STATE&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;next &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;+ &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;RUNIT)) &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;?&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;next &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;: &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;acquireRead&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;))&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;//&lt;/span&gt;如果队列为空并且读锁线程数未超过限制(小于126)，则通过 CAS操作将state加RUNIT(加1)&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;若操作不成功，则调用acquiRead（）函数。&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=none;fontFamily=Helvetica;fontSize=14;align=left;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="2900" y="800" width="620" height="280" as="geometry" />
        </mxCell>
        <mxCell id="Ej6mf5tEDbmiwn3buK7E-5" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;pre style=&quot;color: rgb(255 , 128 , 0) ; text-align: center ; font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;public long &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic ; font-size: 14px&quot;&gt;writeLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;() {&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;next&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;((((&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;= &lt;/span&gt;state&lt;span style=&quot;font-size: 14px&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;ABITS) &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;0L &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;             &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;compareAndSwapLong&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;STATE&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;next &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;+ &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;WBIT)) &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;?&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;next &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;: &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;acquireWrite&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-size: 14px&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;))&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 14px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;//ABITS 1111 1111,低8位全为1,((&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;= state) &amp;amp; ABITS) == 0L,&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;表明state低8位全部为0，说明既没有读锁，也没有写锁&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;通过CAS操作将state第八位设置为1（低8位全为0，只需要加上WBIT即可）；&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;若操作不成功，则调用acquireWrite（）函数进入阻塞队列，并进行自旋。&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=none;fontFamily=Helvetica;fontSize=14;align=left;arcSize=10;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="3600" y="800" width="640" height="280" as="geometry" />
        </mxCell>
        <mxCell id="qHkZKfYIwSoKQyKUJhUR-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=1.005;entryY=0.444;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="Sfc9aITo4xTI0m3XfOoi-1" source="Ej6mf5tEDbmiwn3buK7E-9" target="VU9lz8AgeltI_XvXMwfi-1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="Ej6mf5tEDbmiwn3buK7E-9" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;span style=&quot;font-size: 16px ; text-align: left&quot;&gt;ReadLockView&lt;/span&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lockInterruptibly() throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock(long time, TimeUnit unit) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;span style=&quot;font-size: x-small&quot;&gt;+ void unlock();&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontColor=#000000;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="2199" y="312" width="430" height="150" as="geometry" />
        </mxCell>
        <mxCell id="Ej6mf5tEDbmiwn3buK7E-10" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;span style=&quot;font-size: 16px ; text-align: left&quot;&gt;WNode&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;span style=&quot;font-size: x-small&quot;&gt;+ volatile prev:WNode;&lt;/span&gt;&lt;br&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ volatile next:WNode;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ volatile cowait:WNode;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ volatile thread:Thread;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ volatile status:int;&lt;font color=&quot;#ea6b66&quot;&gt;//0;&lt;/font&gt;&lt;/font&gt;&lt;span style=&quot;font-style: italic&quot;&gt;&lt;font style=&quot;font-size: 12px&quot; color=&quot;#ea6b66&quot;&gt;WAITING;CANCELLED&lt;/font&gt;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ final mode:int;&lt;font color=&quot;#ff6666&quot;&gt; //RMODE:读;WMODE:写&lt;/font&gt;&lt;/font&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px ; margin-left: 4px&quot;&gt;&lt;span style=&quot;font-size: x-small&quot;&gt;+ WNode(int m, WNode p) { mode = m; prev = p; }&lt;/span&gt;&lt;br&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;sketch=1;fillColor=#ffe6cc;strokeColor=#d79b00;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="3590" y="470" width="324" height="167" as="geometry" />
        </mxCell>
        <mxCell id="Ej6mf5tEDbmiwn3buK7E-11" value="CLH队列节点" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.oval_callout;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=16;align=center;fontColor=#FF8000;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="3900" y="430" width="165" height="68" as="geometry" />
        </mxCell>
        <mxCell id="qHkZKfYIwSoKQyKUJhUR-6" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="Sfc9aITo4xTI0m3XfOoi-1" source="VU9lz8AgeltI_XvXMwfi-0" target="VU9lz8AgeltI_XvXMwfi-4">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="VU9lz8AgeltI_XvXMwfi-0" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;span style=&quot;font-size: 16px ; text-align: left&quot;&gt;WriteLockView&lt;/span&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ void lockInterruptibly() throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ boolean tryLock(long time, TimeUnit unit) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;span style=&quot;font-size: x-small&quot;&gt;+ void unlock();&lt;/span&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontColor=#000000;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="2209" y="674.5" width="430" height="150" as="geometry" />
        </mxCell>
        <mxCell id="VU9lz8AgeltI_XvXMwfi-1" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;final class &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ReadLockView &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;implements &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Lock &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() { &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;readLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;lockInterruptibly&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;InterruptedException &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;readLockInterruptibly&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;tryLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() { &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;tryReadLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;tryLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;time&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;TimeUnit &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;unit&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;InterruptedException &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;tryReadLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;time&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;unit&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;unlock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() { &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;unstampedUnlockRead&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Condition &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;newCondition&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;UnsupportedOperationException&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=1;labelBackgroundColor=none;sketch=1;fontFamily=Helvetica;fontSize=14;align=left;arcSize=7;fillColor=#ffe6cc;strokeColor=#FF9933;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="1559" y="242" width="560" height="320" as="geometry" />
        </mxCell>
        <mxCell id="VU9lz8AgeltI_XvXMwfi-4" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;final class &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;WriteLockView &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;implements &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Lock &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;lock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() { &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;writeLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;lockInterruptibly&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;InterruptedException &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;writeLockInterruptibly&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;tryLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() { &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;tryWriteLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;tryLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;time&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;TimeUnit &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;unit&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;InterruptedException &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;tryWriteLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;time&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;unit&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;unlock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() { &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;unstampedUnlockWrite&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Condition &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;newCondition&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;UnsupportedOperationException&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=1;labelBackgroundColor=none;sketch=1;fontFamily=Helvetica;fontSize=14;strokeColor=#d79b00;align=left;arcSize=7;fillColor=#ffe6cc;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="1559" y="602" width="560" height="295" as="geometry" />
        </mxCell>
        <mxCell id="qHkZKfYIwSoKQyKUJhUR-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="Sfc9aITo4xTI0m3XfOoi-1" source="7JDtL0tR_l5SlFASerlo-1" target="7JDtL0tR_l5SlFASerlo-3">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="7JDtL0tR_l5SlFASerlo-1" value="&lt;p style=&quot;margin: 0px ; margin-top: 4px ; text-align: center&quot;&gt;&lt;span style=&quot;font-size: 16px ; text-align: left&quot;&gt;ReadWriteLockView&lt;/span&gt;&lt;/p&gt;&lt;hr size=&quot;1&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ readLock(): ReadLock implements Lock;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px&quot;&gt;&lt;font size=&quot;1&quot;&gt;+ writeLock():WriteLock implements Lock;&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontColor=#000000;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="2209" y="997" width="430" height="150" as="geometry" />
        </mxCell>
        <mxCell id="7JDtL0tR_l5SlFASerlo-3" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;final class &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ReadWriteLockView &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;implements &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ReadWriteLock &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Lock &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;readLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() { &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;asReadLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;public &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Lock &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;writeLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() { &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;asWriteLock&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=0;glass=1;labelBackgroundColor=none;sketch=1;fontFamily=Helvetica;fontSize=14;strokeColor=#d79b00;align=left;arcSize=11;fillColor=#ffe6cc;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="1559" y="962" width="560" height="220" as="geometry" />
        </mxCell>
        <mxCell id="qHkZKfYIwSoKQyKUJhUR-10" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private long &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;acquireWrite&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;interruptible&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;deadline&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;for &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;spins &lt;/span&gt;= -1;;) {&lt;span style=&quot;font-style: italic&quot;&gt;&lt;font color=&quot;#cc0000&quot;&gt;//入队前先自旋&lt;/font&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;m&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;ns&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;((&lt;span style=&quot;font-weight: bold&quot;&gt;m &lt;/span&gt;= (&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;= state) &amp;amp; ABITS) == 0L) {//没有读锁和写锁&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(U.compareAndSwapLong(&lt;span style=&quot;font-weight: bold&quot;&gt;this&lt;/span&gt;, STATE, &lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;ns &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;+ WBIT))&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ns&lt;/span&gt;;&lt;i&gt;&lt;font color=&quot;#cc0000&quot;&gt;//自旋的过程拿到了锁，返回&lt;/font&gt;&lt;/i&gt;&lt;br&gt;        }&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;spins &lt;/span&gt;&amp;lt; 0)&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;spins &lt;/span&gt;= (&lt;span style=&quot;font-weight: bold&quot;&gt;m &lt;/span&gt;== WBIT &amp;amp;&amp;amp; wtail == whead) ? SPINS : 0;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;spins &lt;/span&gt;&amp;gt; 0) {&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;LockSupport&lt;/span&gt;.nextSecondarySeed() &amp;gt;= 0)&lt;br&gt;                --&lt;span style=&quot;font-weight: bold&quot;&gt;spins&lt;/span&gt;;&lt;br&gt;        }&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;((&lt;span style=&quot;font-weight: bold&quot;&gt;p &lt;/span&gt;= wtail) == &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;) { &lt;span style=&quot;font-style: italic&quot;&gt;// initialize queue&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;hd &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;new &lt;/span&gt;WNode(WMODE, &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;);&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(U.compareAndSwapObject(&lt;span style=&quot;font-weight: bold&quot;&gt;this&lt;/span&gt;, WHEAD, &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;hd&lt;/span&gt;))&lt;br&gt;                wtail = &lt;span style=&quot;font-weight: bold&quot;&gt;hd&lt;/span&gt;;&lt;br&gt;        }&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;node &lt;/span&gt;== &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;)&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;node &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;new &lt;/span&gt;WNode(WMODE, &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;);&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;.prev != &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;)&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;.prev = &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(U.compareAndSwapObject(&lt;span style=&quot;font-weight: bold&quot;&gt;this&lt;/span&gt;, WTAIL, &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;)) {&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;.next = &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;;&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;break&lt;/span&gt;;&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;for &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;spins &lt;/span&gt;= -1;;) {&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;np&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;pp&lt;/span&gt;; &lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ps&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;((&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;= whead) == &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;) {&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;spins &lt;/span&gt;&amp;lt; 0)&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;spins &lt;/span&gt;= HEAD_SPINS;&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;spins &lt;/span&gt;&amp;lt; MAX_HEAD_SPINS)&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;spins &lt;/span&gt;&amp;lt;&amp;lt;= 1;&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;for &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;k &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;spins&lt;/span&gt;;;) { &lt;span style=&quot;font-style: italic&quot;&gt;// spin at head&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;ns&lt;/span&gt;;&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(((&lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;= state) &amp;amp; ABITS) == 0L) {&lt;br&gt;                    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(U.compareAndSwapLong(&lt;span style=&quot;font-weight: bold&quot;&gt;this&lt;/span&gt;, STATE, &lt;span style=&quot;font-weight: bold&quot;&gt;s&lt;/span&gt;,&lt;br&gt;                                             &lt;span style=&quot;font-weight: bold&quot;&gt;ns &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;s &lt;/span&gt;+ WBIT)) {&lt;br&gt;                        whead = &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;;&lt;br&gt;                        &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;.prev = &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;;&lt;br&gt;                        &lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ns&lt;/span&gt;;&lt;br&gt;                    }&lt;br&gt;                }&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;LockSupport&lt;/span&gt;.nextSecondarySeed() &amp;gt;= 0 &amp;amp;&amp;amp;&lt;br&gt;                         --&lt;span style=&quot;font-weight: bold&quot;&gt;k &lt;/span&gt;&amp;lt;= 0)&lt;br&gt;                    &lt;span style=&quot;font-weight: bold&quot;&gt;break&lt;/span&gt;;&lt;br&gt;            }&lt;br&gt;        }&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;) { &lt;span style=&quot;font-style: italic&quot;&gt;// help release stale waiters&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;; &lt;span style=&quot;font-weight: bold&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;w&lt;/span&gt;;&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;while &lt;/span&gt;((&lt;span style=&quot;font-weight: bold&quot;&gt;c &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;.cowait) != &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;) {&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(U.compareAndSwapObject(&lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;, WCOWAIT, &lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;.cowait) &amp;amp;&amp;amp;&lt;br&gt;                    (&lt;span style=&quot;font-weight: bold&quot;&gt;w &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;c&lt;/span&gt;.thread) != &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;)&lt;br&gt;                    U.unpark(&lt;span style=&quot;font-weight: bold&quot;&gt;w&lt;/span&gt;);&lt;br&gt;            }&lt;br&gt;        }&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(whead == &lt;span style=&quot;font-weight: bold&quot;&gt;h&lt;/span&gt;) {&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;((&lt;span style=&quot;font-weight: bold&quot;&gt;np &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;.prev) != &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;) {&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;np &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;)&lt;br&gt;                    (&lt;span style=&quot;font-weight: bold&quot;&gt;p &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;np&lt;/span&gt;).next = &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;;   &lt;span style=&quot;font-style: italic&quot;&gt;// stale&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;            &lt;/span&gt;}&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;((&lt;span style=&quot;font-weight: bold&quot;&gt;ps &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;.status) == 0)&lt;br&gt;                U.compareAndSwapInt(&lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;, WSTATUS, 0, WAITING);&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;ps &lt;/span&gt;== CANCELLED) {&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;((&lt;span style=&quot;font-weight: bold&quot;&gt;pp &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;.prev) != &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;) {&lt;br&gt;                    &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;.prev = &lt;span style=&quot;font-weight: bold&quot;&gt;pp&lt;/span&gt;;&lt;br&gt;                    &lt;span style=&quot;font-weight: bold&quot;&gt;pp&lt;/span&gt;.next = &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;;&lt;br&gt;                }&lt;br&gt;            }&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;else &lt;/span&gt;{&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;time&lt;/span&gt;; &lt;span style=&quot;font-style: italic&quot;&gt;// 0 argument to park means no timeout&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;deadline &lt;/span&gt;== 0L)&lt;br&gt;                    &lt;span style=&quot;font-weight: bold&quot;&gt;time &lt;/span&gt;= 0L;&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;else if &lt;/span&gt;((&lt;span style=&quot;font-weight: bold&quot;&gt;time &lt;/span&gt;= &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;deadline &lt;/span&gt;- &lt;span style=&quot;font-weight: bold&quot;&gt;System&lt;/span&gt;.nanoTime()) &amp;lt;= 0L)&lt;br&gt;                    &lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;cancelWaiter(&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;false&lt;/span&gt;);&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;wt &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;.currentThread();&lt;br&gt;                U.putObject(&lt;span style=&quot;font-weight: bold&quot;&gt;wt&lt;/span&gt;, PARKBLOCKER, &lt;span style=&quot;font-weight: bold&quot;&gt;this&lt;/span&gt;);&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;.thread = &lt;span style=&quot;font-weight: bold&quot;&gt;wt&lt;/span&gt;;&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;.status &amp;lt; 0 &amp;amp;&amp;amp; (&lt;span style=&quot;font-weight: bold&quot;&gt;p &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;|| (state &amp;amp; ABITS) != 0L) &amp;amp;&amp;amp;&lt;br&gt;                    whead == &lt;span style=&quot;font-weight: bold&quot;&gt;h &lt;/span&gt;&amp;amp;&amp;amp; &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;.prev == &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;)&lt;br&gt;                    U.park(&lt;span style=&quot;font-weight: bold&quot;&gt;false&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;time&lt;/span&gt;);  &lt;span style=&quot;font-style: italic&quot;&gt;// emulate LockSupport.park&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;.thread = &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;;&lt;br&gt;                U.putObject(&lt;span style=&quot;font-weight: bold&quot;&gt;wt&lt;/span&gt;, PARKBLOCKER, &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;);&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;interruptible &lt;/span&gt;&amp;amp;&amp;amp; &lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;.interrupted())&lt;br&gt;                    &lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;cancelWaiter(&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;true&lt;/span&gt;);&lt;br&gt;            }&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;}&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;fillWeight=4;hachureGap=8;hachureAngle=45;sketch=0;shadow=0;glass=1;labelBackgroundColor=none;fontFamily=Helvetica;fontSize=14;align=left;labelBorderColor=none;arcSize=4;strokeColor=#d79b00;gradientColor=#ffffff;fillColor=#FF9933;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="3600" y="1160" width="640" height="1520" as="geometry" />
        </mxCell>
        <mxCell id="_QYZ-EQdjNQcMyFvNFl4-0" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 14px;&quot;&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;private long &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;acquireRead&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;interruptible&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;deadline&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= -&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;whead&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;wtail&lt;span style=&quot;font-size: 14px;&quot;&gt;)) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;state&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;ABITS) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;RFULL &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;?&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;compareAndSwapLong&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;STATE&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;+ &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;RUNIT) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;:&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WBIT &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;tryIncReaderOverflow&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;))&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WBIT) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;gt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;LockSupport&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;nextSecondarySeed&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                            &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;--&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;nh &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;whead&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;np &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;wtail&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;nh &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;np &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;nh&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;np&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;))&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;SPINS&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) { &lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 14px;&quot;&gt;// initialize queue&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;hd &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WNode&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(WMODE&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;compareAndSwapObject&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WHEAD&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;))&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;wtail &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;hd&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WNode&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(RMODE&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;mode &lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;RMODE) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;prev &lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;prev &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;compareAndSwapObject&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WTAIL&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;next &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;compareAndSwapObject&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WCOWAIT&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;,&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                                         &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;cowait &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;cowait&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;))&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;cowait &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;w&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;whead&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;cowait&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;compareAndSwapObject&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WCOWAIT&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;cowait&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;w &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;thread&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 14px;&quot;&gt;// help release&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;unpark&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;w&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;prev&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;do &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;state&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;ABITS) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;RFULL &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;?&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                            &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;compareAndSwapLong&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;STATE&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;,&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                                                 &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;+ &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;RUNIT) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;:&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                            &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WBIT &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                             &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;tryIncReaderOverflow&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;))&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;while &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WBIT)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;whead &lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;prev &lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;time&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;status &lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;gt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 14px;&quot;&gt;// throw away&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;deadline &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;time &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;time &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;deadline &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;- &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;System&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;nanoTime&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;cancelWaiter&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;wt &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;currentThread&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;putObject&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;wt&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;PARKBLOCKER&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;thread &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;wt&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;state &lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;ABITS) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WBIT) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;whead &lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;prev &lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;park&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;time&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;thread &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;putObject&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;wt&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;PARKBLOCKER&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;interruptible &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;interrupted&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;())&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;cancelWaiter&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= -&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;np&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ps&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;whead&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;HEAD_SPINS&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;MAX_HEAD_SPINS)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt;&amp;lt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;for &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;k &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;spins&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) { &lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 14px;&quot;&gt;// spin at head&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;state&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;ABITS) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;RFULL &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;?&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;compareAndSwapLong&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;STATE&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;+ &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;RUNIT) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;:&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WBIT &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;tryIncReaderOverflow&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;s&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;w&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;whead &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;prev &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;while &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;cowait&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;compareAndSwapObject&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WCOWAIT&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;,&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                                                   &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;cowait&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                            &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;w &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;thread&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                            U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;unpark&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;w&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ns&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;m &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WBIT &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                         &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;LockSupport&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;nextSecondarySeed&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;() &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0 &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp; --&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;k &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;break&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;WNode &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;w&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;while &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;cowait&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;compareAndSwapObject&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WCOWAIT&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;cowait&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;w &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;c&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;thread&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;unpark&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;w&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;whead &lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;np &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;prev&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;np &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    (&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;np&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;next &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;   &lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 14px;&quot;&gt;// stale&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic; font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ps &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;status&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;compareAndSwapInt&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WSTATUS&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WAITING)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;ps &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;CANCELLED) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;prev&lt;span style=&quot;font-size: 14px;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;) {&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;prev &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;pp&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;next &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;{&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;long &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;time&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;deadline &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;time &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;else if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;((&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;time &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;deadline &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;- &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;System&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;nanoTime&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0L&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;cancelWaiter&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Thread &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;wt &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;currentThread&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;putObject&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;wt&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;PARKBLOCKER&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;thread &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;wt&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;status &lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;lt; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;0 &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;|| &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;state &lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;ABITS) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;WBIT) &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;whead &lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;h &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;prev &lt;span style=&quot;font-size: 14px;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;p&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;park&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;time&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;thread &lt;span style=&quot;font-size: 14px;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;U&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;putObject&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;wt&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;PARKBLOCKER&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic; font-size: 14px;&quot;&gt;interruptible &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;interrupted&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;())&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;                    &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;cancelWaiter&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-size: 14px;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;;&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;        }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;    }&lt;br style=&quot;font-size: 14px;&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;strokeWidth=2;fillWeight=4;hachureGap=8;hachureAngle=45;sketch=0;shadow=0;glass=1;labelBackgroundColor=none;fontFamily=Helvetica;fontSize=14;align=left;strokeColor=#d79b00;arcSize=5;fillColor=#FF9933;gradientColor=#ffffff;" vertex="1" parent="Sfc9aITo4xTI0m3XfOoi-1">
          <mxGeometry x="2780" y="1160" width="660" height="2550" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="IuhS61xIEZ5eRkF4Jo2Y" name="Condition">
    <mxGraphModel dx="514" dy="5325" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="rhP0OTCgmpBrCUrplGVk-0" />
        <mxCell id="rhP0OTCgmpBrCUrplGVk-1" parent="rhP0OTCgmpBrCUrplGVk-0" />
        <mxCell id="tih8tJjj4A0M9frWZ1GX-8" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontSize=18;fontColor=#000000;" parent="rhP0OTCgmpBrCUrplGVk-1" source="dvzmkYD-5V3QiwelHX7K-0" target="dvzmkYD-5V3QiwelHX7K-1" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="dvzmkYD-5V3QiwelHX7K-0" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 12px;&quot;&gt;&lt;i style=&quot;font-size: 12px;&quot;&gt;&amp;lt;&amp;lt;Interface&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 12px;&quot;&gt;&lt;b style=&quot;font-size: 12px;&quot;&gt;Condition&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 12px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; void await() throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; void awaitUninterruptibly();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; long awaitNanos(long nanosTimeout) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; boolean await(long time, TimeUnit unit) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; boolean awaitUntil(Date deadline) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; void signal();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp; &amp;nbsp; void signalAll();&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;rounded=0;glass=0;labelBackgroundColor=#ffffff;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;" parent="rhP0OTCgmpBrCUrplGVk-1" vertex="1">
          <mxGeometry x="2985" y="-3616" width="495" height="166" as="geometry" />
        </mxCell>
        <mxCell id="NgeecOWr_5HMyz8dJ5KH-2" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="dvzmkYD-5V3QiwelHX7K-1" target="NgeecOWr_5HMyz8dJ5KH-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF8000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="dvzmkYD-5V3QiwelHX7K-1">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="2480" y="-2910" as="targetPoint" />
            <Array as="points">
              <mxPoint x="3233" y="-3010" />
              <mxPoint x="2480" y="-3010" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-5" value="&lt;span style=&quot;color: rgb(0, 0, 0); font-size: 16px;&quot;&gt;await()&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Helvetica;fontColor=#FF8000;" vertex="1" connectable="0" parent="aBpvBfCwh9fu5vabpL6D-2">
          <mxGeometry x="0.3039" y="3" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.449;entryY=-0.006;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Helvetica;fontSize=14;fontColor=#FF8000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="dvzmkYD-5V3QiwelHX7K-1" target="cty0Z-pJkADAmItuoEGn-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-6" value="&lt;span style=&quot;color: rgb(0, 0, 0); font-size: 16px;&quot;&gt;awaitUninterruptibly()&amp;nbsp;&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Helvetica;fontColor=#FF8000;" vertex="1" connectable="0" parent="aBpvBfCwh9fu5vabpL6D-3">
          <mxGeometry x="0.6277" y="2" relative="1" as="geometry">
            <mxPoint y="-1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-7" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF8000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="dvzmkYD-5V3QiwelHX7K-1" target="0vDgf71Hyd0LE6ZwrYQh-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3233" y="-3010" />
              <mxPoint x="4480" y="-3010" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-11" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="dvzmkYD-5V3QiwelHX7K-1" target="aBpvBfCwh9fu5vabpL6D-9">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3233" y="-3010" />
              <mxPoint x="5295" y="-3010" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-12" value="signalAll()" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="aBpvBfCwh9fu5vabpL6D-11">
          <mxGeometry x="0.4971" relative="1" as="geometry">
            <mxPoint as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-13" value="&lt;span style=&quot;font-size: 16px;&quot;&gt;signal()&lt;/span&gt;" style="edgeLabel;html=1;align=center;verticalAlign=middle;resizable=0;points=[];fontSize=16;fontFamily=Helvetica;fontColor=#000000;" vertex="1" connectable="0" parent="aBpvBfCwh9fu5vabpL6D-11">
          <mxGeometry x="-0.2969" y="-3" relative="1" as="geometry">
            <mxPoint x="1" as="offset" />
          </mxGeometry>
        </mxCell>
        <mxCell id="dvzmkYD-5V3QiwelHX7K-1" value="&lt;p style=&quot;margin: 4px 0px 0px; text-align: center; font-size: 12px;&quot;&gt;&lt;i style=&quot;font-size: 12px;&quot;&gt;&amp;lt;&amp;lt;Class&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 12px;&quot;&gt;&lt;b style=&quot;font-size: 12px;&quot;&gt;ConditionObject&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 12px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;+&amp;nbsp; firstWaiter:Node //双向链表头指针&lt;/p&gt;&lt;hr style=&quot;font-size: 12px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;+&amp;nbsp;&amp;nbsp;lastWaiter: Node//双向链表尾指针&lt;/p&gt;&lt;hr style=&quot;font-size: 12px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;/p&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;&amp;nbsp;void await() throws InterruptedException;&lt;/span&gt;&lt;br style=&quot;font-size: 12px;&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;void awaitUninterruptibly();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;span style=&quot;font-size: 12px;&quot;&gt;long awaitNanos(long nanosTimeout) throws InterruptedException;&lt;/span&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;boolean await(long time, TimeUnit unit) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;boolean awaitUntil(Date deadline) throws InterruptedException;&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;void signal();&lt;/font&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px; font-size: 12px;&quot;&gt;&lt;font style=&quot;font-size: 12px;&quot;&gt;void signalAll();&lt;/font&gt;&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=12;fontFamily=Helvetica;html=1;rounded=0;glass=0;labelBackgroundColor=#ffffff;fontColor=#000000;strokeColor=#000000;fillColor=#ffffff;" parent="rhP0OTCgmpBrCUrplGVk-1" vertex="1">
          <mxGeometry x="2985" y="-3348" width="495" height="228" as="geometry" />
        </mxCell>
        <mxCell id="dvzmkYD-5V3QiwelHX7K-2" value="Condition功能和wait/notify类似，用来线程间通信，wait（）/notify（）必须和synchronized一起使用，Condition也是如此，必须和Lock一起使用。" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.cloud_callout;labelBackgroundColor=#ffffff;fontSize=18;fontColor=#000000;align=left;" parent="rhP0OTCgmpBrCUrplGVk-1" vertex="1">
          <mxGeometry x="3550" y="-3748" width="548" height="208" as="geometry" />
        </mxCell>
        <mxCell id="0vDgf71Hyd0LE6ZwrYQh-9" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=16;fontColor=#000000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="tih8tJjj4A0M9frWZ1GX-0">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="3252" y="-3618" as="targetPoint" />
          </mxGeometry>
        </mxCell>
        <mxCell id="tih8tJjj4A0M9frWZ1GX-0" value="&lt;h1&gt;Condition实现原理&lt;/h1&gt;&lt;p&gt;因为Condition必须和Lock一起使用，所以Condition的实现也是Lock的一部分。下面先分别看一下互斥锁和读写锁中Condition的构造，互斥锁和读写锁中的写锁都是返回一个ConditionObject对象，而读写锁中的读锁 不支持Condition，每一个Condition对象上面，都阻塞了多个线程。因此，在ConditionObject内部也有一个双向链表组成的队列&lt;/p&gt;" style="text;html=1;strokeColor=none;fillColor=none;spacing=5;spacingTop=-20;whiteSpace=wrap;overflow=hidden;rounded=0;labelBackgroundColor=#ffffff;fontSize=18;fontColor=#000000;align=left;" parent="rhP0OTCgmpBrCUrplGVk-1" vertex="1">
          <mxGeometry x="2980" y="-3920" width="544" height="230" as="geometry" />
        </mxCell>
        <mxCell id="tih8tJjj4A0M9frWZ1GX-9" value="ConditionObject是AQS的一个内部类" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.cloud_callout;labelBackgroundColor=#ffffff;fontSize=18;fontColor=#000000;align=left;" parent="rhP0OTCgmpBrCUrplGVk-1" vertex="1">
          <mxGeometry x="3540" y="-3388" width="340" height="86" as="geometry" />
        </mxCell>
        <mxCell id="NgeecOWr_5HMyz8dJ5KH-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.436;entryY=-0.009;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="tih8tJjj4A0M9frWZ1GX-10" target="NgeecOWr_5HMyz8dJ5KH-3">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2480" y="-1940" />
              <mxPoint x="2891" y="-1940" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0fyW0a2vNmq8tBNPjFEy-4" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.277;entryY=0;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="tih8tJjj4A0M9frWZ1GX-10" target="0fyW0a2vNmq8tBNPjFEy-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="2480" y="-1940" />
              <mxPoint x="3540" y="-1940" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="tih8tJjj4A0M9frWZ1GX-10" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-size: 16px&quot;&gt;//释放锁，阻塞自己，进入&lt;/font&gt;&lt;font style=&quot;font-size: 16px&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;Condition等待队列&lt;/font&gt;&lt;b&gt;&lt;font color=&quot;#cc0000&quot;&gt;（相当于synchronized的等待池）&lt;/font&gt;&lt;/b&gt;&lt;/font&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre style=&quot;font-size: 16px&quot;&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;public final void &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;await&lt;/span&gt;() &lt;span style=&quot;font-weight: bold&quot;&gt;throws &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;InterruptedException &lt;/span&gt;{&lt;font color=&quot;#ea6b66&quot;&gt;//响应中断&lt;/font&gt;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;.interrupted())&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;throw new &lt;/span&gt;InterruptedException();&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node &lt;/span&gt;= addConditionWaiter();&lt;font color=&quot;#ea6b66&quot;&gt;//添加到Condition等待队列&lt;/font&gt;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;savedState &lt;/span&gt;= fullyRelease(&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;);&lt;font color=&quot;#ea6b66&quot;&gt;//阻塞之前必须先释放锁，否则会死锁，返回释放&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;    锁之前的state&lt;br&gt;&lt;/font&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interruptMode &lt;/span&gt;= 0;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt; &lt;font color=&quot;#ea6b66&quot;&gt;   //当前线程节点不在AQS等待队列&lt;/font&gt;&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;while &lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;(!isOnSyncQueue(&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;)) {&lt;/span&gt;&lt;/font&gt;&lt;font color=&quot;#ea6b66&quot;&gt;&lt;font style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 16px&quot;&gt;//&lt;/font&gt;isOnSyncQueue()是AQS里的函数,确保不是被中断唤醒&lt;br&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot; style=&quot;font-size: 16px&quot; color=&quot;#ea6b66&quot;&gt;&lt;span&gt; &lt;font style=&quot;font-size: 16px&quot;&gt;   用于判断该Node是否在AQS的同步队列里面;初始的时候，Node只在Condition的队列里，&lt;/font&gt;&lt;/span&gt;&lt;/font&gt;&lt;font face=&quot;pt mono&quot; style=&quot;white-space: normal&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;而不在AQS&lt;/font&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;pt mono&quot; style=&quot;white-space: normal&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;&amp;nbsp; &amp;nbsp; 的队列里。&lt;/font&gt;&lt;b&gt;&lt;font color=&quot;#ff0000&quot;&gt;但执行notity操作的时候，会放进AQS的同步队列（相当于&lt;/font&gt;&lt;/b&gt;&lt;/font&gt;&lt;b style=&quot;font-family: &amp;#34;helvetica&amp;#34; ; white-space: normal&quot;&gt;&lt;font color=&quot;#ff0000&quot;&gt;synchronized&lt;font style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;锁池）&lt;/font&gt;&lt;/font&gt;&lt;/b&gt;&lt;font color=&quot;#ea6b66&quot; style=&quot;white-space: normal ; font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;。&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;LockSupport&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;.park(&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;this&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;);&lt;/span&gt;&lt;/font&gt;&lt;font color=&quot;#ea6b66&quot; style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;//阻塞自己&lt;/font&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;&lt;br&gt;        &lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;((&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;interruptMode &lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;= checkInterruptWhileWaiting(&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;)) != 0)&lt;br&gt;            &lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;break&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;;&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;&lt;span&gt; &lt;span&gt;	&lt;/span&gt;&lt;/span&gt;不是被中断唤醒，跳出循环，进行后面流程&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font color=&quot;#ea6b66&quot;&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;&lt;span&gt; &lt;span&gt;	&lt;/span&gt;&lt;/span&gt;检测在park期间是否收到过中断信号；当线程被唤醒时，有两种可能：&lt;/span&gt;&lt;/font&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font color=&quot;#ea6b66&quot;&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;&lt;span&gt; &lt;span&gt;	&lt;/span&gt;&lt;/span&gt;(1)其他线程调用了unpark()；&lt;/span&gt;&lt;/font&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font color=&quot;#ea6b66&quot;&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;&lt;span&gt; &lt;span&gt;	&lt;/span&gt;&lt;/span&gt;(2)收到中断信号；&lt;/span&gt;&lt;/font&gt;&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;  &lt;font color=&quot;#ea6b66&quot;&gt;  //重新拿锁，&lt;/font&gt;&lt;font color=&quot;#ea6b66&quot;&gt;acquireQueued()返回是否被中断&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;acquireQueued&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;savedState&lt;/span&gt;&lt;span&gt;) &lt;/span&gt;&lt;span&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interruptMode &lt;/span&gt;&lt;span&gt;!= &lt;/span&gt;&lt;span&gt;THROW_IE)&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interruptMode &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;REINTERRUPT&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;nextWaiter &lt;span&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;&lt;span&gt;) &lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;// clean up if cancelled&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;        &lt;/span&gt;&lt;span&gt;unlinkCancelledWaiters&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interruptMode &lt;/span&gt;&lt;span&gt;!= &lt;/span&gt;&lt;span&gt;0&lt;/span&gt;&lt;span&gt;)&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;reportInterruptAfterWait&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interruptMode&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;arcSize=5;verticalAlign=top;shadow=1;sketch=0;glass=1;" parent="rhP0OTCgmpBrCUrplGVk-1" vertex="1">
          <mxGeometry x="2080" y="-2908" width="800" height="868" as="geometry" />
        </mxCell>
        <mxCell id="0fyW0a2vNmq8tBNPjFEy-2" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.559;entryY=-0.011;entryDx=0;entryDy=0;entryPerimeter=0;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="cty0Z-pJkADAmItuoEGn-0" target="NgeecOWr_5HMyz8dJ5KH-3">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3263" y="-1940" />
              <mxPoint x="2976" y="-1940" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="0fyW0a2vNmq8tBNPjFEy-3" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#000000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="cty0Z-pJkADAmItuoEGn-0" target="0fyW0a2vNmq8tBNPjFEy-1">
          <mxGeometry relative="1" as="geometry">
            <Array as="points">
              <mxPoint x="3263" y="-1940" />
              <mxPoint x="3685" y="-1940" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="cty0Z-pJkADAmItuoEGn-0" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold&quot;&gt;public final void &lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal ; font-weight: bold ; font-style: italic&quot;&gt;awaitUninterruptibly&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt ; white-space: normal&quot;&gt;() {&lt;font color=&quot;#ea6b66&quot;&gt;//不会响应中断&lt;/font&gt;&lt;/span&gt;&lt;br&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;addConditionWaiter&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;savedState &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span&gt;fullyRelease&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interrupted &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;false&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;while &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;!&lt;/span&gt;&lt;span&gt;isOnSyncQueue&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span&gt;)) {&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;LockSupport&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;park&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;this&lt;/span&gt;&lt;span&gt;)&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Thread&lt;/span&gt;&lt;span&gt;.&lt;/span&gt;&lt;span&gt;interrupted&lt;/span&gt;&lt;span&gt;())&lt;br&gt;&lt;/span&gt;&lt;span&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interrupted &lt;/span&gt;&lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;true&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span&gt;}&lt;br&gt;&lt;/span&gt;&lt;span&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span&gt;acquireQueued&lt;/span&gt;&lt;span&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;savedState&lt;/span&gt;&lt;span&gt;) &lt;/span&gt;&lt;span&gt;|| &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;interrupted&lt;/span&gt;&lt;span&gt;)&lt;br&gt;&lt;/span&gt;&lt;span&gt;        &lt;/span&gt;&lt;span&gt;selfInterrupt&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=7;shadow=1;glass=1;labelBackgroundColor=#ffffff;align=left;" parent="rhP0OTCgmpBrCUrplGVk-1" vertex="1">
          <mxGeometry x="2963" y="-2908" width="600" height="320" as="geometry" />
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-0" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=14;fontColor=#FF8000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="0vDgf71Hyd0LE6ZwrYQh-1" target="0vDgf71Hyd0LE6ZwrYQh-7">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0vDgf71Hyd0LE6ZwrYQh-1" value="&lt;pre&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;public final void &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold ; font-style: italic&quot;&gt;signal&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;isHeldExclusively&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;())&lt;font color=&quot;#ea6b66&quot;&gt;//检查是否持有锁&lt;/font&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;IllegalMonitorStateException&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;first &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;= &lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;firstWaiter&lt;/span&gt;&lt;/font&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;first &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;doSignal&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt ; font-weight: bold&quot;&gt;first&lt;/span&gt;&lt;span style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;)&lt;/span&gt;&lt;font face=&quot;pt mono&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;;&lt;font color=&quot;#ea6b66&quot;&gt;//&lt;/font&gt;&lt;/span&gt;&lt;font color=&quot;#ea6b66&quot;&gt;&lt;span style=&quot;font-size: 17.0667px&quot;&gt;从Condition等待队列中取出排在第一的节点，唤醒它&lt;/span&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;/font&gt;&lt;/font&gt;&lt;div style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;}&lt;/font&gt;&lt;/span&gt;&lt;/div&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;arcSize=10;glass=1;shadow=1;align=left;labelBackgroundColor=#ffffff;" vertex="1" parent="rhP0OTCgmpBrCUrplGVk-1">
          <mxGeometry x="4121.5" y="-2880" width="717" height="198" as="geometry" />
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-1" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;entryX=0.5;entryY=0;entryDx=0;entryDy=0;fontFamily=Helvetica;fontSize=14;fontColor=#FF8000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="0vDgf71Hyd0LE6ZwrYQh-7" target="0vDgf71Hyd0LE6ZwrYQh-8">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0vDgf71Hyd0LE6ZwrYQh-7" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;doSignal&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;first&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;do &lt;/span&gt;{&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;( (firstWaiter = &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;first&lt;/span&gt;.nextWaiter) == &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;)&lt;br&gt;            lastWaiter = &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;;&lt;br&gt;        &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;first&lt;/span&gt;.nextWaiter = &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;;&lt;font color=&quot;#ea6b66&quot;&gt;//头指针指向下个节点&lt;/font&gt;&lt;br&gt;    } &lt;span style=&quot;font-weight: bold&quot;&gt;while &lt;/span&gt;(!transferForSignal(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;first&lt;/span&gt;) &amp;amp;&amp;amp;&lt;br&gt;             (&lt;span style=&quot;font-weight: bold&quot;&gt;first &lt;/span&gt;= firstWaiter) != &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;);&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;&lt;font color=&quot;#ea6b66&quot;&gt;//循环条件：&lt;/font&gt;&lt;/span&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;font color=&quot;#ea6b66&quot;&gt;&lt;span&gt;（1）未成功将节点从&lt;/span&gt;Condition等待队列添加到AQS等待队列（等待池-&amp;gt;锁池）&lt;/font&gt;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span&gt;&lt;font color=&quot;#ea6b66&quot;&gt;（2）Condition等待队列排在第一的节点存在&lt;/font&gt;&lt;br&gt;&lt;/span&gt;&lt;span&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontSize=16;align=left;arcSize=8;" vertex="1" parent="rhP0OTCgmpBrCUrplGVk-1">
          <mxGeometry x="4121.5" y="-2600" width="718.5" height="320" as="geometry" />
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-16" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=16;fontColor=#000000;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="0vDgf71Hyd0LE6ZwrYQh-8" target="FClK7gox8-6hvwTiOzUA-0">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="0vDgf71Hyd0LE6ZwrYQh-8" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;final boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;transferForSignal&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;) {&lt;br&gt; &lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(!compareAndSetWaitStatus(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;Node&lt;/span&gt;.CONDITION, 0))&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;return false&lt;/span&gt;;&lt;br&gt; &lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;p &lt;/span&gt;= enq(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;);&lt;font color=&quot;#ea6b66&quot;&gt;//加入AQS等待队列，返回&lt;/font&gt;&lt;font color=&quot;#ea6b66&quot;&gt;当前线程节点的前置节点&lt;/font&gt;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;.waitStatus;&lt;font color=&quot;#ea6b66&quot;&gt;//前置节点的waitStatus&lt;/font&gt;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;ws &lt;/span&gt;&amp;gt; 0 || !compareAndSetWaitStatus(&lt;span style=&quot;font-weight: bold&quot;&gt;p&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;ws&lt;/span&gt;, &lt;span style=&quot;font-weight: bold&quot;&gt;Node&lt;/span&gt;.SIGNAL))&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;LockSupport&lt;/span&gt;.unpark(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;.thread);&lt;font color=&quot;#ea6b66&quot;&gt;//唤醒当前线程&lt;/font&gt;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;return true&lt;/span&gt;;&lt;br&gt;}&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontSize=16;align=left;arcSize=6;" vertex="1" parent="rhP0OTCgmpBrCUrplGVk-1">
          <mxGeometry x="4121.5" y="-2200" width="720" height="320" as="geometry" />
        </mxCell>
        <mxCell id="NgeecOWr_5HMyz8dJ5KH-0" value="&lt;p style=&quot;margin: 4px 0px 0px ; text-align: center ; font-size: 14px&quot;&gt;&lt;i style=&quot;font-size: 14px&quot;&gt;&amp;lt;&amp;lt;Class&amp;gt;&amp;gt;&lt;/i&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;b style=&quot;font-size: 14px&quot;&gt;Node&lt;/b&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 14px&quot;&gt;&lt;pre style=&quot;font-size: 14px&quot;&gt;&lt;font face=&quot;Helvetica&quot;&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;static final &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;SHARED &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;static final &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;EXCLUSIVE &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;static final int &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;CANCELLED &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;=  &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;static final int &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;SIGNAL    &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;= -&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;1&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;static final int &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;CONDITION &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;= -&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;2&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;span style=&quot;font-style: italic ; font-size: 14px&quot;&gt;&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;static final int &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;PROPAGATE &lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;= -&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;3&lt;/span&gt;&lt;span style=&quot;font-size: 14px&quot;&gt;;&lt;/span&gt;&lt;/font&gt;&lt;/pre&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 14px&quot;&gt;+ waitStatus: int volatile&lt;br style=&quot;font-size: 14px&quot;&gt;+ prev: Node&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 14px&quot;&gt;+ next: Node&lt;br style=&quot;font-size: 14px&quot;&gt;&lt;/p&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 14px&quot;&gt;+ nextWaitor: Node//和Condition相关&lt;br&gt;&lt;/p&gt;&lt;hr style=&quot;font-size: 14px&quot;&gt;&lt;p style=&quot;margin: 0px 0px 0px 4px ; font-size: 14px&quot;&gt;+ isShared(): boolean&lt;br style=&quot;font-size: 14px&quot;&gt;+ predecessor(): Node&lt;/p&gt;" style="verticalAlign=top;align=left;overflow=fill;fontSize=14;fontFamily=Helvetica;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;" vertex="1" parent="rhP0OTCgmpBrCUrplGVk-1">
          <mxGeometry x="3940" y="-3384" width="290" height="300" as="geometry" />
        </mxCell>
        <mxCell id="NgeecOWr_5HMyz8dJ5KH-3" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;private &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;addConditionWaiter&lt;/span&gt;&lt;span style=&quot;&quot;&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;lastWaiter&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;// If lastWaiter is cancelled, clean out.&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;&lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null &lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;amp;&amp;amp; &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;waitStatus &lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;CONDITION) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;unlinkCancelledWaiters&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;lastWaiter&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Thread&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;currentThread&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;CONDITION)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;&lt;span style=&quot;&quot;&gt;== &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;firstWaiter &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;else&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;nextWaiter &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;lastWaiter &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=14;align=left;arcSize=13;" vertex="1" parent="rhP0OTCgmpBrCUrplGVk-1">
          <mxGeometry x="2590" y="-1800" width="690" height="440" as="geometry" />
        </mxCell>
        <mxCell id="NgeecOWr_5HMyz8dJ5KH-5" value="Node里面有2个属性：waitStatus, nextWaiter&lt;br&gt;waitStatus 和Condition相关；nextWaiter和Lock相关&lt;br&gt;Lock相关的nextWaiter有：&lt;br&gt;&lt;pre&gt;&lt;font face=&quot;Helvetica&quot; style=&quot;font-size: 14px&quot;&gt;static final Node SHARED = new Node();共享锁&lt;br&gt;static final Node EXCLUSIVE = null;互斥锁&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;Helvetica&quot; style=&quot;font-size: 14px&quot;&gt;Condition相关的waitStatus有:&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;font face=&quot;Helvetica&quot;&gt;static final int CANCELLED =  1;&lt;br&gt;static final int SIGNAL    = -1;&lt;br&gt;static final int CONDITION = -2;&lt;br&gt;static final int PROPAGATE = -3;&lt;/font&gt;&lt;/pre&gt;&lt;pre&gt;&lt;pre&gt;&lt;font face=&quot;Helvetica&quot; style=&quot;font-size: 14px&quot;&gt;&lt;b&gt;Node(Thread thread, Node mode) {     // Used by Lock；addWaiter&lt;br&gt;    this.nextWaiter = mode;&lt;br&gt;    this.thread = thread;&lt;br&gt;}&lt;br&gt;&lt;br&gt;Node(Thread thread, int waitStatus) { // Used by Condition; addConditionWaiter&lt;br&gt;    this.waitStatus = waitStatus;&lt;br&gt;    this.thread = thread;&lt;br&gt;}&lt;/b&gt;&lt;/font&gt;&lt;/pre&gt;&lt;/pre&gt;" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.roundRectCallout;dx=12;dy=20;size=5;boundedLbl=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=14;align=left;fontColor=#FF8000;" vertex="1" parent="rhP0OTCgmpBrCUrplGVk-1">
          <mxGeometry x="4240" y="-3600" width="530" height="400" as="geometry" />
        </mxCell>
        <mxCell id="0fyW0a2vNmq8tBNPjFEy-1" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;final int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;fullyRelease&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;true&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;try &lt;/span&gt;&lt;span style=&quot;&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;savedState &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;getState&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;release&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;savedState&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;false&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;savedState&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;} &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;else &lt;/span&gt;&lt;span style=&quot;&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;&quot;&gt;IllegalMonitorStateException&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    } &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;finally &lt;/span&gt;&lt;span style=&quot;&quot;&gt;{&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;failed&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;waitStatus &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;CANCELLED&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=14;align=left;arcSize=9;" vertex="1" parent="rhP0OTCgmpBrCUrplGVk-1">
          <mxGeometry x="3360" y="-1800" width="650" height="440" as="geometry" />
        </mxCell>
        <mxCell id="FClK7gox8-6hvwTiOzUA-0" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;enq&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;) {&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;for &lt;/span&gt;(;;) {&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;= tail;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;t &lt;/span&gt;== &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;) { &lt;span style=&quot;font-style: italic&quot;&gt;//初始化链表&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;            &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(compareAndSetHead(&lt;span style=&quot;font-weight: bold&quot;&gt;new &lt;/span&gt;Node()))&lt;br&gt;                tail = head;&lt;br&gt;        } &lt;span style=&quot;font-weight: bold&quot;&gt;else &lt;/span&gt;{&lt;br&gt;            &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;.prev = &lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;;&lt;/pre&gt;&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34;&quot;&gt;            //CAS让tail指向当前节点&lt;br&gt;            &lt;span style=&quot;font-weight: bold&quot;&gt;if &lt;/span&gt;(compareAndSetTail(&lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;, &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;)) {&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;.next = &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;node&lt;/span&gt;;&lt;br&gt;                &lt;span style=&quot;font-weight: bold&quot;&gt;return &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;t&lt;/span&gt;;//返回node的前置节点&lt;br&gt;            }&lt;br&gt;        }&lt;br&gt;    }&lt;br&gt;}&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=16;fontColor=#000000;align=left;arcSize=10;" vertex="1" parent="rhP0OTCgmpBrCUrplGVk-1">
          <mxGeometry x="4121.5" y="-1800" width="718.5" height="390" as="geometry" />
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-9" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;public final void &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;signalAll&lt;/span&gt;&lt;span style=&quot;&quot;&gt;() {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;&quot;&gt;!&lt;/span&gt;&lt;span style=&quot;&quot;&gt;isHeldExclusively&lt;/span&gt;&lt;span style=&quot;&quot;&gt;())&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;&quot;&gt;IllegalMonitorStateException&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;first &lt;/span&gt;&lt;span style=&quot;&quot;&gt;= &lt;/span&gt;firstWaiter&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;first &lt;/span&gt;&lt;span style=&quot;&quot;&gt;!= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;&quot;&gt;doSignalAll&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;first&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=14;align=left;" vertex="1" parent="rhP0OTCgmpBrCUrplGVk-1">
          <mxGeometry x="5000" y="-2880" width="640" height="200" as="geometry" />
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-14" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontFamily=Helvetica;fontSize=16;fontColor=#000000;entryX=1.001;entryY=0.522;entryDx=0;entryDy=0;entryPerimeter=0;" edge="1" parent="rhP0OTCgmpBrCUrplGVk-1" source="aBpvBfCwh9fu5vabpL6D-10" target="0vDgf71Hyd0LE6ZwrYQh-8">
          <mxGeometry relative="1" as="geometry">
            <mxPoint x="5260" y="-2180" as="targetPoint" />
            <Array as="points">
              <mxPoint x="4921" y="-2425" />
              <mxPoint x="4921" y="-2033" />
            </Array>
          </mxGeometry>
        </mxCell>
        <mxCell id="aBpvBfCwh9fu5vabpL6D-10" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private void &lt;/span&gt;&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;doSignalAll&lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;first&lt;/span&gt;) {&lt;br&gt;    lastWaiter = firstWaiter = &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;;&lt;font color=&quot;#ea6b66&quot;&gt;//头指针和尾指针置空&lt;/font&gt;&lt;br&gt;    &lt;span style=&quot;font-weight: bold&quot;&gt;do &lt;/span&gt;{&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;Node &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;next &lt;/span&gt;= &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;first&lt;/span&gt;.nextWaiter;&lt;br&gt;        &lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;first&lt;/span&gt;.nextWaiter = &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;;&lt;br&gt;        transferForSignal(&lt;span style=&quot;font-weight: bold ; font-style: italic&quot;&gt;first&lt;/span&gt;);&lt;font color=&quot;#ea6b66&quot;&gt;//遍历Condition队列，挨个唤醒&lt;/font&gt;&lt;br&gt;        &lt;span style=&quot;font-weight: bold&quot;&gt;first &lt;/span&gt;= &lt;span style=&quot;font-weight: bold&quot;&gt;next&lt;/span&gt;;&lt;br&gt;    } &lt;span style=&quot;font-weight: bold&quot;&gt;while &lt;/span&gt;(&lt;span style=&quot;font-weight: bold&quot;&gt;first &lt;/span&gt;!= &lt;span style=&quot;font-weight: bold&quot;&gt;null&lt;/span&gt;);&lt;br&gt;}&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;shadow=1;glass=1;labelBackgroundColor=#ffffff;fontFamily=Helvetica;fontSize=14;align=left;" vertex="1" parent="rhP0OTCgmpBrCUrplGVk-1">
          <mxGeometry x="5000" y="-2600" width="640" height="322" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="RcCwE2SFOWVnL2of2GJ7" name="阻塞队列">
    <mxGraphModel dx="2514" dy="1325" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="3000" pageHeight="3000" math="0" shadow="0">
      <root>
        <mxCell id="aZrIO7PyOFQsN65T9nqu-0" />
        <mxCell id="aZrIO7PyOFQsN65T9nqu-1" parent="aZrIO7PyOFQsN65T9nqu-0" />
        <mxCell id="aZrIO7PyOFQsN65T9nqu-2" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;public &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;ArrayBlockingQueue&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;capacity&lt;/span&gt;&lt;span style=&quot;&quot;&gt;, &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;boolean &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;fair&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;capacity &lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;lt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;        &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;&quot;&gt;IllegalArgumentException&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;items &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;&quot;&gt;Object&lt;/span&gt;&lt;span style=&quot;&quot;&gt;[&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;capacity&lt;/span&gt;&lt;span style=&quot;&quot;&gt;]&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;lock &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;&quot;&gt;ReentrantLock&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;fair&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;notEmpty &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;lock&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;newCondition&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;notFull &lt;span style=&quot;&quot;&gt;=  &lt;/span&gt;lock&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;&lt;span style=&quot;&quot;&gt;newCondition&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;arcSize=10;" parent="aZrIO7PyOFQsN65T9nqu-1" vertex="1">
          <mxGeometry x="350" y="440" width="580" height="230" as="geometry" />
        </mxCell>
        <mxCell id="aZrIO7PyOFQsN65T9nqu-6" value="" style="edgeStyle=orthogonalEdgeStyle;rounded=0;orthogonalLoop=1;jettySize=auto;html=1;fontSize=18;fontColor=#000000;" parent="aZrIO7PyOFQsN65T9nqu-1" source="aZrIO7PyOFQsN65T9nqu-3" target="aZrIO7PyOFQsN65T9nqu-2" edge="1">
          <mxGeometry relative="1" as="geometry" />
        </mxCell>
        <mxCell id="aZrIO7PyOFQsN65T9nqu-3" value="ArrayBlockingQueue" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=#ffffff;fontSize=18;fontColor=#000000;" parent="aZrIO7PyOFQsN65T9nqu-1" vertex="1">
          <mxGeometry x="550" y="300" width="180" height="40" as="geometry" />
        </mxCell>
        <mxCell id="aZrIO7PyOFQsN65T9nqu-5" value="核心：&lt;br&gt;（1）基于数组实现&lt;br&gt;（2）1把互斥锁 + 2个Condition&lt;br&gt;（3）可以指定锁的类型（公平 | 非公平）" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.roundRectCallout;dx=30;dy=15;size=5;boundedLbl=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;" parent="aZrIO7PyOFQsN65T9nqu-1" vertex="1">
          <mxGeometry x="810" y="180" width="370" height="180" as="geometry" />
        </mxCell>
        <mxCell id="aZrIO7PyOFQsN65T9nqu-7" value="LinkedBlockingQueue" style="text;html=1;strokeColor=none;fillColor=none;align=center;verticalAlign=middle;whiteSpace=wrap;rounded=0;labelBackgroundColor=#ffffff;fontSize=18;fontColor=#000000;" parent="aZrIO7PyOFQsN65T9nqu-1" vertex="1">
          <mxGeometry x="1590" y="290" width="40" height="20" as="geometry" />
        </mxCell>
        <mxCell id="aZrIO7PyOFQsN65T9nqu-8" value="&lt;pre style=&quot;font-family: &amp;quot;pt mono&amp;quot;; font-size: 12.8pt;&quot;&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;public &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;LinkedBlockingQueue&lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;int &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;capacity&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) {&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;if &lt;/span&gt;&lt;span style=&quot;&quot;&gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;capacity &lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;lt;= &lt;/span&gt;&lt;span style=&quot;&quot;&gt;0&lt;/span&gt;&lt;span style=&quot;&quot;&gt;) &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;throw new &lt;/span&gt;&lt;span style=&quot;&quot;&gt;IllegalArgumentException&lt;/span&gt;&lt;span style=&quot;&quot;&gt;()&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;this&lt;/span&gt;&lt;span style=&quot;&quot;&gt;.&lt;/span&gt;capacity &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold; font-style: italic;&quot;&gt;capacity&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;    &lt;/span&gt;last &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;head &lt;span style=&quot;&quot;&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;new &lt;/span&gt;&lt;span style=&quot;&quot;&gt;Node&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;lt;&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;E&lt;/span&gt;&lt;span style=&quot;&quot;&gt;&amp;gt;(&lt;/span&gt;&lt;span style=&quot;font-weight: bold;&quot;&gt;null&lt;/span&gt;&lt;span style=&quot;&quot;&gt;)&lt;/span&gt;&lt;span style=&quot;&quot;&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;&quot;&gt;}&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;" parent="aZrIO7PyOFQsN65T9nqu-1" vertex="1">
          <mxGeometry x="1510" y="400" width="640" height="150" as="geometry" />
        </mxCell>
        <mxCell id="aZrIO7PyOFQsN65T9nqu-9" value="核心：&lt;br&gt;（1）基于单向链表实现&lt;br&gt;（2）2把互斥锁 + 2个Condition，读线程与写线程是分开的，相互不影响&lt;br&gt;（3）使用非公平锁，不能指定锁类型" style="whiteSpace=wrap;html=1;shape=mxgraph.basic.roundRectCallout;dx=30;dy=15;size=5;boundedLbl=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;" parent="aZrIO7PyOFQsN65T9nqu-1" vertex="1">
          <mxGeometry x="1700" y="170" width="620" height="150" as="geometry" />
        </mxCell>
        <mxCell id="ZZE2RP4JMpxsp6Ju23jP-0" value="&lt;pre style=&quot;font-family: &amp;#34;pt mono&amp;#34; ; font-size: 12.8pt&quot;&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ReentrantLock &lt;/span&gt;takeLock &lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;new &lt;/span&gt;&lt;span&gt;ReentrantLock&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Condition &lt;/span&gt;notEmpty &lt;span&gt;= &lt;/span&gt;takeLock&lt;span&gt;.&lt;/span&gt;&lt;span&gt;newCondition&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;ReentrantLock &lt;/span&gt;putLock &lt;span&gt;= &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;new &lt;/span&gt;&lt;span&gt;ReentrantLock&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-style: italic&quot;&gt;&lt;br&gt;&lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;private final &lt;/span&gt;&lt;span style=&quot;font-weight: bold&quot;&gt;Condition &lt;/span&gt;notFull &lt;span&gt;= &lt;/span&gt;putLock&lt;span&gt;.&lt;/span&gt;&lt;span&gt;newCondition&lt;/span&gt;&lt;span&gt;()&lt;/span&gt;&lt;span&gt;;&lt;/span&gt;&lt;/pre&gt;" style="rounded=1;whiteSpace=wrap;html=1;labelBackgroundColor=#ffffff;fontSize=18;align=left;arcSize=7;" parent="aZrIO7PyOFQsN65T9nqu-1" vertex="1">
          <mxGeometry x="1530" y="620" width="620" height="190" as="geometry" />
        </mxCell>
      </root>
    </mxGraphModel>
  </diagram>
  <diagram id="Kxkb-lBrypZYT15_ESdc" name="并发容器">
    <mxGraphModel dx="2514" dy="1325" grid="1" gridSize="10" guides="1" tooltips="1" connect="1" arrows="1" fold="1" page="1" pageScale="1" pageWidth="2000" pageHeight="2000" math="0" shadow="0">
      <root>
        <mxCell id="obIFzqk-aB33rnTvV9ip-0" />
        <mxCell id="obIFzqk-aB33rnTvV9ip-1" parent="obIFzqk-aB33rnTvV9ip-0" />
      </root>
    </mxGraphModel>
  </diagram>
</mxfile>
